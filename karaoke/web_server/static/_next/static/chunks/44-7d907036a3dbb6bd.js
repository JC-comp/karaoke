(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44],{559:(e,t,s)=>{"use strict";s.d(t,{A:()=>g});var n=s(5155),i=s(2115),a=s(6874),r=s.n(a),o=s(7489),c=s(3578),l=s(4298),d=s(8359),u=s(5754);function m(e){let{className:t,icon:s,children:a,modalProps:r,modelHeader:o,modalBody:c,onOk:l}=e,[d,m]=(0,i.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{className:t,onClick:()=>m(!0),children:[s,a&&(0,n.jsx)("span",{children:a})]}),(0,n.jsxs)(u.A,{...r,show:d,onHide:()=>m(!1),children:[(0,n.jsx)(u.A.Header,{closeButton:!0,children:o}),(0,n.jsx)(u.A.Body,{children:c}),(0,n.jsxs)(u.A.Footer,{children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>m(!1),children:"Close"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:()=>{l(),m(!1)},children:"Save Changes"})]})]})]})}function h(e){let{roomID:t,setRoomID:s}=e,[a,r]=(0,i.useState)("");return(0,n.jsx)(m,{className:"btn btn-outline-secondary btn-sm",icon:(0,n.jsx)(o.g,{icon:c._qq}),children:"Change Room",modalProps:{size:"lg",centered:!0},modelHeader:(0,n.jsx)("span",{children:"Change Room"}),modalBody:(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{htmlFor:"roomID",className:"form-label",children:"Room ID"}),(0,n.jsx)("input",{type:"text",className:"form-control",placeholder:t||"Room name",value:a,onChange:e=>r(e.target.value)})]}),onOk:()=>{a&&s(a),r("")}})}function p(e){let{className:t,content:s,icon:a,text:r}=e,[l,d]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(l){let e=setTimeout(()=>{d(!1)},1e3);return()=>clearTimeout(e)}},[l]),(0,n.jsxs)("button",{className:"btn btn-sm ".concat(l?"btn-success":t),onClick:()=>{navigator.clipboard.writeText(s).then(()=>{d(!0)}).catch(e=>{console.error("Failed to copy: ",e)})},children:[l?(0,n.jsx)(o.g,{icon:c.e68}):a,(0,n.jsx)("span",{children:l?"Copied":r})]})}class f{static fromJSON(e,t){return new f(e.is_fullscreen,e.is_playing,e.is_vocal_on,e.room_name,e.version,e.volume,e.playlist,t)}update(e){this.is_fullscreen=e.body.is_fullscreen,this.is_playing=e.body.is_playing,this.is_vocal_on=e.body.is_vocal_on,this.room_name=e.body.room_name,this.version=e.body.version,this.volume=e.body.volume,this.playlist=e.body.playlist,this.pendingCallback[e.request_id]&&(this.pendingCallback[e.request_id](),delete this.pendingCallback[e.request_id])}moveToNextItem(){this.playlist.length>0&&this.deletePlaylistItem(this.playlist[0])}constructor(e,t,s,n,i,a,r,o){this.operationWrapper=(e,t)=>new Promise(s=>{var n;let i=Math.random().toString(36);t.request_id=i;let a=setTimeout(()=>{this.pendingCallback[i]&&delete this.pendingCallback[i],s()},5e3);this.pendingCallback[i]=()=>{clearTimeout(a),s()},null===(n=this.socket)||void 0===n||n.emit(e,t)}),this.playlistItemOperationWrapper=(e,t)=>this.operationWrapper(e,{room_id:this.room_name,item_id:t.item_id}),this.moveItemToTop=e=>this.playlistItemOperationWrapper("first",e),this.deletePlaylistItem=e=>this.playlistItemOperationWrapper("delete",e),this.setPlay=e=>this.operationWrapper("setplay",{room_id:this.room_name,is_playing:e}),this.is_fullscreen=e,this.is_playing=t,this.is_vocal_on=s,this.room_name=n,this.version=i,this.volume=a,this.playlist=r,this.socket=o,this.pendingCallback={}}}let b=e=>{let{item:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h5",{className:"track-title",children:t.title}),(0,n.jsx)("p",{className:"artist-name text-truncate",children:t.artist})]})};function g(e){let{kareokeRoomModel:t,setKareokeRoomModel:s,roomID:a,setRoomID:u,version:m,setVersion:g}=e,[x,j]=(0,i.useState)(!0),v=(0,i.useRef)(null),y=(0,i.useRef)(null),k=()=>{var e="?roomID=".concat(btoa(a||""),"#search");return"/"!==window.location.pathname&&(e="/"+e),e},_=()=>"/ktv?roomID=".concat(btoa(a||""));if((0,i.useEffect)(()=>{let e=(0,l.io)("/ktv",{transports:["websocket"],path:"/ws"});return e.on("connect",()=>{e.emit("join",a)}),e.on("update",t=>{s(s=>s?(s.update(t),s):f.fromJSON(t.body,e)),g(e=>e+1),u(t.body.room_name)}),()=>{e.off("connect"),e.off("update"),e.disconnect(),s(null)}},[a]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{j(!1)},3e3);function t(e){var t,s;let n=e.target;(null===(t=v.current)||void 0===t?void 0:t.contains(n))||(null===(s=y.current)||void 0===s?void 0:s.contains(n))||j(!1)}function s(e){document.removeEventListener("touchstart",n),t(e)}function n(n){document.removeEventListener("click",s),t(n),clearTimeout(e)}return document.addEventListener("click",s),document.addEventListener("touchstart",n),()=>{document.removeEventListener("click",s),document.removeEventListener("touchstart",n)}},[]),!t)return(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2 position-sticky top-50",children:[(0,n.jsx)(o.g,{icon:c.z1G,spin:!0,size:"2x"}),(0,n.jsx)("p",{children:"Preparing your room..."})]});let N=()=>(0,n.jsxs)(n.Fragment,{children:[", please add songs with the ",(0,n.jsx)(r(),{href:k(),children:"search tab"})]});return(0,n.jsxs)("div",{className:"kareoke-room-container",children:[(0,n.jsxs)("div",{ref:v,className:"kareoke-room ".concat(x?"open":""),children:[(0,n.jsxs)("div",{className:"room-header",children:[(0,n.jsx)("div",{className:"room-info",children:(0,n.jsxs)("small",{className:"text-muted",children:["Room Name:",(0,n.jsxs)(r(),{className:"ms-2",href:"/ktv"===window.location.pathname?k():_(),children:[t.room_name,(0,n.jsx)(o.g,{icon:c.vMs,className:"ms-1"})]})]})}),(0,n.jsxs)("div",{className:"room-actions controls",children:[(0,n.jsx)(h,{roomID:a,setRoomID:u}),(0,n.jsx)(p,{className:"btn-outline-info",content:"".concat(window.location.origin).concat(_()),icon:(0,n.jsx)(o.g,{icon:c.jPR}),text:"Share Link"})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:"Now Playing"}),(0,n.jsx)("div",{className:"card-body",children:t.playlist.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b,{item:t.playlist[0]}),(0,n.jsxs)("div",{className:"controls",children:[(0,n.jsx)(d.A,{className:"btn btn-sm ".concat(t.is_playing?"btn-secondary":"btn-primary"),icon:(0,n.jsx)(o.g,{icon:t.is_playing?c.G1Y:c.ijD}),onClick:()=>t.setPlay(!t.is_playing),children:t.is_playing?"Pause":"Play"}),(0,n.jsx)(d.A,{className:"btn btn-warning btn-sm",icon:(0,n.jsx)(o.g,{icon:c.vFJ}),onClick:()=>t.deletePlaylistItem(t.playlist[0]),children:"Skip"})]})]}):(0,n.jsxs)("p",{className:"text-muted",children:["No song in the queue",(0,n.jsx)(N,{})]})})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:"Coming Up Next"}),t.playlist.length>1?(0,n.jsx)("ul",{className:"list-group list-group-flush playlist-container",children:t.playlist.slice(1).map(e=>(0,n.jsxs)("li",{className:"list-group-item playlist-item",children:[(0,n.jsx)("div",{className:"song-info",children:(0,n.jsx)(b,{item:e})}),(0,n.jsxs)("div",{className:"controls",children:[(0,n.jsx)(d.A,{className:"btn btn-sm btn-danger",icon:(0,n.jsx)(o.g,{icon:c.yLS}),onClick:()=>t.deletePlaylistItem(e),children:null}),(0,n.jsx)(d.A,{className:"btn btn-sm btn-info",icon:(0,n.jsx)(o.g,{icon:c.INu}),onClick:()=>t.moveItemToTop(e),children:"First"})]})]},e.item_id))}):(0,n.jsx)("div",{className:"card-body overflow-auto",children:(0,n.jsxs)("p",{className:"text-muted",children:["No upcoming songs",(0,n.jsx)(N,{})]})})]})]}),(0,n.jsx)("div",{ref:y,className:"fab btn btn-primary ".concat(x?"open":""),onClick:()=>j(!x),children:(0,n.jsx)(o.g,{icon:c.Tsj,size:"2x"})})]})}},1469:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var n=s(4298);let i=(e,t,s,i,a)=>{let r=(0,n.io)(e,{transports:["websocket"],path:"/ws"});var o=null;let c=()=>{o&&clearTimeout(o),o=setTimeout(()=>{s(),r.connect()},3e3)},l=()=>{o&&clearTimeout(o),o=setTimeout(()=>{s(),r.emit("join",t)},3e3)};return r.on("connect",()=>{console.log("WebSocket connection opened"),s(),r.emit("join",t)}),r.on("disconnect",e=>{"io server disconnect"===e&&(i("Server disconnected the socket"),c())}),r.on("error",e=>{i(e.message),r.emit("leave",t),l()}),r.on("connect_error",e=>{console.log("Connection error:",e),i("Connection error: "+e.message),c()}),r.on("joined",e=>{a&&a()}),{socket:r,unsubscribe:()=>{r.off("connect"),r.off("progress"),r.off("disconnect"),r.off("error"),r.off("connect_error"),r.off("joined"),o&&clearTimeout(o),r.disconnect()}}}},2732:()=>{},3401:(e,t,s)=>{"use strict";s.d(t,{cR:()=>c,qY:()=>r});var n=s(5155),i=s(7489),a=s(3578);let r=e=>{switch(e){case"pending":case"soft_failed":case"skipped":return"text-warning";case"queued":case"interrupting":return"text-info";case"created":case"running":return"text-primary";case"completed":return"text-success";case"failed":case"canceled":case"interrupted":return"text-danger";default:return""}},o=e=>{switch(e){case"running":return{spin:!0};case"queued":case"created":case"interrupting":return{fade:!0};default:return{}}},c=e=>{var t;switch(e){case"pending":t=a.SVv;break;case"queued":t=a.Exz;break;case"created":t=a.CQO;break;case"running":t=a.z1G;break;case"completed":t=a.SGM;break;case"soft_failed":t=a.lEd;break;case"failed":t=a.s0Q;break;case"skipped":t=a.vFJ;break;case"interrupting":t=a.APi;break;case"canceled":t=a.Dfk;break;case"interrupted":t=a.bFI;break;default:t=null}return t?(0,n.jsx)(i.g,{icon:t,...o(e),className:r(e)}):null}},4463:(e,t,s)=>{"use strict";s.d(t,{Ok:()=>a,Zr:()=>o,h1:()=>r});var n=s(5799),i=s(5695);let a=(e,t)=>(null==t||t(!0),fetch("/api/create-job",{method:"POST",body:e}).then(e=>e.json().catch(()=>{throw Error(e.statusText)})).then(e=>{if(!e.success)throw Error(e.message);return e.body.jid}).finally(()=>{null==t||t(!1)})),r=()=>{let e=(0,i.useRouter)();return(t,s)=>{n.oR.info("Submitting data and retrieving job info...",{autoClose:!1,isLoading:!0,draggable:!1}),a(t,s).finally(()=>{n.oR.dismiss()}).then(t=>{n.oR.success("Job information retrieved successfully!",{autoClose:2e3}),e.push("/job?jobId=".concat(t))}).catch(e=>{n.oR.error("Failed to start job: ".concat((null==e?void 0:e.message)||e))})}};function o(e){return e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}},5410:()=>{},5464:(e,t,s)=>{"use strict";s.d(t,{y:()=>i});var n=s(5695);function i(e){let{encodedRoomID:t}=e,s=(0,n.useRouter)(),i=t?atob(t):null;return{roomID:i,setRoomID:e=>{e&&e!==i&&s.push("?roomID=".concat(btoa(e)))}}}},6365:(e,t,s)=>{"use strict";s.d(t,{C:()=>i});class n{hasArtifact(){for(let e of this.artifacts)if(!e.is_attached)return!0;return!1}static fromJSON(e){return new n(e.tid,e.name,e.status,e.message,e.output,e.artifacts)}constructor(e,t,s,n,i,a){this.tid=e,this.name=t,this.status=s,this.message=n,this.output=i,this.artifacts=a}}class i{isRunning(){switch(this.status){case"pending":case"queued":case"created":case"running":return!0;case"interrupting":case"interrupted":case"completed":case"failed":case"canceled":return!1}}static fromJSON(e){return new i(e.jid,e.created_at,e.started_at,e.finished_at,e.type,e.media,e.status,e.message,e.isProcessExited,e.artifact_tags,Object.fromEntries(Object.entries(e.tasks).map(e=>{let[t,s]=e;return[t,n.fromJSON(s)]})))}constructor(e,t,s,n,i,a,r,o,c,l,d){this.jid=e,this.created_at=t,this.started_at=s,this.finished_at=n,this.type=i,this.media=a,this.status=r,this.message=o,this.isProcessExited=c,this.artifact_tags=l,this.tasks=d}}},8359:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var n=s(5155),i=s(2115),a=s(7489),r=s(3578);function o(e){let{className:t,icon:s,children:o,onClick:c}=e,[l,d]=(0,i.useState)(!1);return(0,n.jsxs)("button",{className:t,onClick:()=>{d(!0),c().finally(()=>{d(!1)})},disabled:l,children:[l?(0,n.jsx)(a.g,{icon:r.z1G,spin:!0}):s,o&&(0,n.jsx)("span",{children:o})]})}}}]);