(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[707],{1469:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var n=t(4298);let i=(e,s,t,i)=>{let a=(0,n.io)(e,{transports:["websocket"],path:"/ws"});var r=null;let o=()=>{r&&clearTimeout(r),r=setTimeout(()=>{t(),a.connect()},3e3)},c=()=>{r&&clearTimeout(r),r=setTimeout(()=>{t(),a.emit("join",s)},3e3)};return a.on("connect",()=>{console.log("WebSocket connection opened"),t(),a.emit("join",s)}),a.on("disconnect",e=>{"io server disconnect"===e&&(i("Server disconnected the socket"),o())}),a.on("error",e=>{i(e.message),a.emit("leave",s),c()}),a.on("connect_error",e=>{console.log("Connection error:",e),i("Connection error: "+e.message),o()}),{socket:a,unsubscribe:()=>{a.off("connect"),a.off("progress"),a.off("disconnect"),a.off("error"),a.off("connect_error"),r&&clearTimeout(r),a.disconnect()}}}},2732:()=>{},3401:(e,s,t)=>{"use strict";t.d(s,{cR:()=>c,qY:()=>r});var n=t(5155),i=t(7489),a=t(3578);let r=e=>{switch(e){case"pending":case"soft_failed":case"skipped":return"text-warning";case"queued":case"interrupting":return"text-info";case"created":case"running":return"text-primary";case"completed":return"text-success";case"failed":case"canceled":case"interrupted":return"text-danger";default:return""}},o=e=>{switch(e){case"running":return{spin:!0};case"queued":case"created":case"interrupting":return{fade:!0};default:return{}}},c=e=>{var s;switch(e){case"pending":s=a.SVv;break;case"queued":s=a.Exz;break;case"created":s=a.CQO;break;case"running":s=a.z1G;break;case"completed":s=a.SGM;break;case"soft_failed":s=a.lEd;break;case"failed":s=a.s0Q;break;case"skipped":s=a.vFJ;break;case"interrupting":s=a.APi;break;case"canceled":s=a.Dfk;break;case"interrupted":s=a.bFI;break;default:s=null}return s?(0,n.jsx)(i.g,{icon:s,...o(e),className:r(e)}):null}},4463:(e,s,t)=>{"use strict";t.d(s,{Ok:()=>a,Zr:()=>o,h1:()=>r});var n=t(5799),i=t(5695);let a=(e,s)=>(null==s||s(!0),fetch("/api/create-job",{method:"POST",body:e}).then(e=>e.json().catch(()=>{throw Error(e.statusText)})).then(e=>{if(!e.success)throw Error(e.message);return e.body.jid}).finally(()=>{null==s||s(!1)})),r=()=>{let e=(0,i.useRouter)();return(s,t)=>{n.oR.info("Submitting data and retrieving job info...",{autoClose:!1,isLoading:!0,draggable:!1}),a(s,t).finally(()=>{n.oR.dismiss()}).then(s=>{n.oR.success("Job information retrieved successfully!",{autoClose:2e3}),e.push("/job?jobId=".concat(s))}).catch(e=>{n.oR.error("Failed to start job: ".concat((null==e?void 0:e.message)||e))})}};function o(e){return e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}},5410:()=>{},5464:(e,s,t)=>{"use strict";t.d(s,{y:()=>i});var n=t(5695);function i(e){let{encodedRoomID:s}=e,t=(0,n.useRouter)(),i=s?atob(s):null;return{roomID:i,setRoomID:e=>{e&&e!==i&&t.push("?roomID=".concat(btoa(e)))}}}},6365:(e,s,t)=>{"use strict";t.d(s,{C:()=>i});class n{hasArtifact(){for(let e of this.artifacts)if(!e.is_attached)return!0;return!1}static fromJSON(e){return new n(e.tid,e.name,e.status,e.message,e.output,e.artifacts)}constructor(e,s,t,n,i,a){this.tid=e,this.name=s,this.status=t,this.message=n,this.output=i,this.artifacts=a}}class i{static fromJSON(e){return new i(e.jid,e.created_at,e.started_at,e.finished_at,e.type,e.media,e.status,e.message,e.isProcessExited,e.result_artifact_index,Object.fromEntries(Object.entries(e.tasks).map(e=>{let[s,t]=e;return[s,n.fromJSON(t)]})))}constructor(e,s,t,n,i,a,r,o,c,l,d){this.jid=e,this.created_at=s,this.started_at=t,this.finished_at=n,this.type=i,this.media=a,this.status=r,this.message=o,this.isProcessExited=c,this.result_artifact_index=l,this.tasks=d}}},8560:(e,s,t)=>{"use strict";t.d(s,{A:()=>j});var n=t(5155),i=t(2115),a=t(6874),r=t.n(a),o=t(7489),c=t(3578),l=t(4298);function d(e){let{className:s,icon:t,children:a,onClick:r}=e,[l,d]=(0,i.useState)(!1);return(0,n.jsxs)("button",{className:s,onClick:()=>{d(!0),r().finally(()=>{d(!1)})},disabled:l,children:[l?(0,n.jsx)(o.g,{icon:c.z1G,spin:!0}):t,a&&(0,n.jsx)("span",{children:a})]})}var m=t(5754);function u(e){let{className:s,icon:t,children:a,modalProps:r,modelHeader:o,modalBody:c,onOk:l}=e,[d,u]=(0,i.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("button",{className:s,onClick:()=>u(!0),children:[t,a&&(0,n.jsx)("span",{children:a})]}),(0,n.jsxs)(m.A,{...r,show:d,onHide:()=>u(!1),children:[(0,n.jsx)(m.A.Header,{closeButton:!0,children:o}),(0,n.jsx)(m.A.Body,{children:c}),(0,n.jsxs)(m.A.Footer,{children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>u(!1),children:"Close"}),(0,n.jsx)("button",{className:"btn btn-primary",onClick:()=>{l(),u(!1)},children:"Save Changes"})]})]})]})}function h(e){let{roomID:s,setRoomID:t}=e,[a,r]=(0,i.useState)("");return(0,n.jsx)(u,{className:"btn btn-outline-secondary btn-sm",icon:(0,n.jsx)(o.g,{icon:c._qq}),children:"Change Room",modalProps:{size:"lg",centered:!0},modelHeader:(0,n.jsx)("span",{children:"Change Room"}),modalBody:(0,n.jsxs)("div",{className:"mb-3",children:[(0,n.jsx)("label",{htmlFor:"roomID",className:"form-label",children:"Room ID"}),(0,n.jsx)("input",{type:"text",className:"form-control",placeholder:s||"Room name",value:a,onChange:e=>r(e.target.value)})]}),onOk:()=>{a&&t(a),r("")}})}function p(e){let{className:s,content:t,icon:a,text:r}=e,[l,d]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if(l){let e=setTimeout(()=>{d(!1)},1e3);return()=>clearTimeout(e)}},[l]),(0,n.jsxs)("button",{className:"btn btn-sm ".concat(l?"btn-success":s),onClick:()=>{navigator.clipboard.writeText(t).then(()=>{d(!0)}).catch(e=>{console.error("Failed to copy: ",e)})},children:[l?(0,n.jsx)(o.g,{icon:c.e68}):a,(0,n.jsx)("span",{children:l?"Copied":r})]})}class x{static fromJSON(e,s){return new x(e.is_fullscreen,e.is_playing,e.is_vocal_on,e.room_name,e.version,e.volume,e.playlist,s)}update(e){this.is_fullscreen=e.body.is_fullscreen,this.is_playing=e.body.is_playing,this.is_vocal_on=e.body.is_vocal_on,this.room_name=e.body.room_name,this.version=e.body.version,this.volume=e.body.volume,this.playlist=e.body.playlist,this.pendingCallback[e.request_id]&&(this.pendingCallback[e.request_id](),delete this.pendingCallback[e.request_id])}moveToNextItem(){this.playlist.length>0&&this.deletePlaylistItem(this.playlist[0])}constructor(e,s,t,n,i,a,r,o){this.operationWrapper=(e,s)=>new Promise(t=>{var n;let i=Math.random().toString(36);s.request_id=i;let a=setTimeout(()=>{this.pendingCallback[i]&&delete this.pendingCallback[i],t()},5e3);this.pendingCallback[i]=()=>{clearTimeout(a),t()},null===(n=this.socket)||void 0===n||n.emit(e,s)}),this.playlistItemOperationWrapper=(e,s)=>this.operationWrapper(e,{room_id:this.room_name,item_id:s.item_id}),this.moveItemToTop=e=>this.playlistItemOperationWrapper("first",e),this.deletePlaylistItem=e=>this.playlistItemOperationWrapper("delete",e),this.setPlay=e=>this.operationWrapper("setplay",{room_id:this.room_name,is_playing:e}),this.is_fullscreen=e,this.is_playing=s,this.is_vocal_on=t,this.room_name=n,this.version=i,this.volume=a,this.playlist=r,this.socket=o,this.pendingCallback={}}}let b=e=>{let{item:s}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h5",{className:"track-title",children:s.title}),(0,n.jsx)("p",{className:"artist-name text-truncate",children:s.artist})]})};function j(e){let{kareokeRoomModel:s,setKareokeRoomModel:t,roomID:a,setRoomID:m,version:u,setVersion:j}=e,[f,g]=(0,i.useState)(!1),y=()=>{var e="?roomID=".concat(btoa(a||""),"#search");return"/"!==window.location.pathname&&(e="/"+e),e},v=()=>"/ktv/?roomID=".concat(btoa(a||""));if((0,i.useEffect)(()=>{let e=(0,l.io)("/ktv",{transports:["websocket"],path:"/ws"});return e.on("connect",()=>{e.emit("join",a)}),e.on("update",s=>{t(t=>t?(t.update(s),t):x.fromJSON(s.body,e)),j(e=>e+1),m(s.body.room_name)}),()=>{e.off("connect"),e.off("update"),e.disconnect(),t(null)}},[a]),!s)return(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2 position-sticky top-50",children:[(0,n.jsx)(o.g,{icon:c.z1G,spin:!0,size:"2x"}),(0,n.jsx)("p",{children:"Preparing your room..."})]});let _=()=>(0,n.jsxs)(n.Fragment,{children:[", please add songs with the ",(0,n.jsx)(r(),{href:y(),children:"search tab"})]});return(0,n.jsxs)("div",{className:"kareoke-room-container",children:[(0,n.jsxs)("div",{className:"kareoke-room ".concat(f?"open":""),children:[(0,n.jsxs)("div",{className:"room-header",children:[(0,n.jsx)("div",{className:"room-info",children:(0,n.jsxs)("small",{className:"text-muted",children:["Room Name:",(0,n.jsxs)(r(),{className:"ms-2",href:"/ktv"===window.location.pathname?y():v(),children:[s.room_name,(0,n.jsx)(o.g,{icon:c.vMs,className:"ms-1"})]})]})}),(0,n.jsxs)("div",{className:"room-actions controls",children:[(0,n.jsx)(h,{roomID:a,setRoomID:m}),(0,n.jsx)(p,{className:"btn-outline-info",content:"".concat(window.location.origin).concat(v()),icon:(0,n.jsx)(o.g,{icon:c.jPR}),text:"Share Link"})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:"Now Playing"}),(0,n.jsx)("div",{className:"card-body",children:s.playlist.length>0?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b,{item:s.playlist[0]}),(0,n.jsxs)("div",{className:"controls",children:[(0,n.jsx)(d,{className:"btn btn-sm ".concat(s.is_playing?"btn-secondary":"btn-primary"),icon:(0,n.jsx)(o.g,{icon:s.is_playing?c.G1Y:c.ijD}),onClick:()=>s.setPlay(!s.is_playing),children:s.is_playing?"Pause":"Play"}),(0,n.jsx)(d,{className:"btn btn-warning btn-sm",icon:(0,n.jsx)(o.g,{icon:c.vFJ}),onClick:()=>s.deletePlaylistItem(s.playlist[0]),children:"Skip"})]})]}):(0,n.jsxs)("p",{className:"text-muted",children:["No song in the queue",(0,n.jsx)(_,{})]})})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("div",{className:"card-header",children:"Coming Up Next"}),s.playlist.length>1?(0,n.jsx)("ul",{className:"list-group list-group-flush playlist-container",children:s.playlist.slice(1).map(e=>(0,n.jsxs)("li",{className:"list-group-item playlist-item",children:[(0,n.jsx)("div",{className:"song-info",children:(0,n.jsx)(b,{item:e})}),(0,n.jsxs)("div",{className:"controls",children:[(0,n.jsx)(d,{className:"btn btn-sm btn-danger",icon:(0,n.jsx)(o.g,{icon:c.yLS}),onClick:()=>s.deletePlaylistItem(e),children:null}),(0,n.jsx)(d,{className:"btn btn-sm btn-info",icon:(0,n.jsx)(o.g,{icon:c.INu}),onClick:()=>s.moveItemToTop(e),children:"First"})]})]},e.item_id))}):(0,n.jsx)("div",{className:"card-body overflow-auto",children:(0,n.jsxs)("p",{className:"text-muted",children:["No upcoming songs",(0,n.jsx)(_,{})]})})]})]}),(0,n.jsx)("div",{className:"fab btn btn-primary ".concat(f?"open":""),onClick:()=>g(!f),children:(0,n.jsx)(o.g,{icon:c.Tsj,size:"2x"})})]})}}}]);