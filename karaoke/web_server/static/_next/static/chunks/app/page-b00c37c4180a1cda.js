(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2918:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var r=s(5155),n=s(2115),a=s(5695),l=s(4463);function o(e){let{isProcessing:t,setIsProcessing:s}=e,[a,o]=(0,n.useState)(""),i=(0,l.h1)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("label",{htmlFor:"youtubeLink",className:"form-label",children:"YouTube Link:"}),(0,r.jsx)("input",{id:"youtubeLink",className:"form-control",type:"url",value:a,onChange:e=>o(e.target.value),placeholder:"Enter YouTube video URL",required:!0}),(0,r.jsxs)("button",{className:"btn btn-primary mt-3",type:"submit",onClick:e=>{if(""===a)return;e.preventDefault();let t=new FormData;t.append("youtubeLink",a),i(t,s)},children:[t?(0,r.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):"Debug",t?" Processing...":""]})]})}function i(e){let{isProcessing:t,setIsProcessing:s}=e,[a,o]=(0,n.useState)(null),i=(0,l.h1)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("label",{htmlFor:"fileUpload",className:"form-label",children:"Upload File:"}),(0,r.jsx)("input",{id:"fileUpload",className:"form-control",type:"file",accept:".mp4, .mkv, .avi, .mov, .flv, .wmv",onChange:e=>{e.target.files&&e.target.files.length>0?o(e.target.files[0]):o(null)},required:!0}),a&&(0,r.jsxs)("p",{className:"text-muted mt-2",children:["Selected file: ",a.name]}),(0,r.jsxs)("button",{className:"btn btn-primary mt-3",type:"submit",onClick:e=>{if(null===a)return;e.preventDefault();let t=new FormData;t.append("file",a),i(t,s)},children:[t?(0,r.jsx)("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):"Debug",t?" Processing...":""]})]})}var c=s(6874),u=s.n(c),d=s(5799),m=s(7489),h=s(3578);let f=e=>{let{closeToast:t,data:s}=e;return(0,r.jsxs)("div",{className:"d-flex flex-column flex-grow-1",children:[(0,r.jsx)("div",{children:"Video already added to queue."}),(0,r.jsx)("button",{className:"btn btn-danger btn-sm mt-2 align-self-end",onClick:()=>{t(),s.add()},children:"Add anyway"})]})};var x=function(e){return e.YOUTUBE="YoutubePlaylistItem",e.SCHEDULE="SchedulePlaylistItem",e}(x||{});let j=e=>{let{roomID:t,body:s,isProcessing:a,setIsProcessing:l,text:o}=e,[i,c]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!s)return;if(i){l(!1),d.oR.warning(f,{data:{add:()=>{c(!1),l(!0)}}});return}let e=new AbortController;if(!t){d.oR.error("Kareoke room is still loading."),l(!1);return}return fetch("/api/ktv/queue",{method:"POST",signal:e.signal,headers:{"Content-Type":"application/json"},body:s}).then(e=>e.json().catch(()=>{throw Error("".concat(e.status,": ").concat(e.statusText))})).then(e=>{if(!e.success)throw Error(e.message);c(!0)}).catch(e=>{"AbortError"!==e.name&&d.oR.error("An error occurred while queuing the video. (".concat(e.message,")"))}).finally(()=>{l(!1)}),()=>{e.abort()}},[s]),(0,n.useEffect)(()=>{c(!1),l(!1)},[t]),(0,r.jsx)("button",{className:"btn ".concat(i?"btn-success":"btn-secondary"," me-2"),onClick:()=>l(!0),disabled:a,children:a?(0,r.jsx)(m.g,{icon:h.z1G,spin:!0}):i?"Queued":o})},b=e=>{let{roomID:t,searchResult:s}=e,[a,l]=(0,n.useState)(!1),[o,i]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(a)return i(JSON.stringify({room_id:t,item_type:"YoutubePlaylistItem",item:s})),()=>{i(null)}},[a]),(0,r.jsx)(j,{roomID:t,body:o,isProcessing:a,setIsProcessing:l,text:"Queue"})},p=e=>{let{roomID:t,searchResult:s}=e,[a,o]=(0,n.useState)(!1),[i,c]=(0,n.useState)(null),[u,m]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(a&&i)return m(JSON.stringify({room_id:t,item_type:"SchedulePlaylistItem",item:{...s,job_id:i}})),()=>{m(null)}},[i,a]),(0,n.useEffect)(()=>{if(!a||i)return;let e=new FormData;e.append("youtubeLink","https://youtube.com".concat(s.url_suffix)),(0,l.Ok)(e).then(e=>{c(e)}).catch(e=>{d.oR.error("An error occurred while queuing the video. (".concat(e.message,")"))})},[a]),(0,r.jsx)(j,{roomID:t,body:u,isProcessing:a,setIsProcessing:o,text:"Convert&Queue"})};function g(e){let{activeTab:t,roomID:s}=e,a=n.useRef(null),[l,o]=(0,n.useState)(""),[i,c]=(0,n.useState)([]),[d,f]=(0,n.useState)(!0),[x,j]=(0,n.useState)(""),[g,v]=(0,n.useState)(!1),[N,y]=(0,n.useState)(!1),[w,S]=(0,n.useState)([]),[k,E]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(0==l.length){c([]);return}fetch("/api/youtube/keyword?q="+encodeURIComponent(l)).then(e=>e.json()).then(e=>{if(!e.success)throw Error(e.message);let t=e.body;t.keyword==l&&c(t.options)}).catch(e=>{console.log(e)})},[l]),(0,n.useEffect)(()=>{if(0==x.length)return;y(!0),E(null);let e=new AbortController;return fetch("/api/youtube/search?q="+encodeURIComponent(x),{signal:e.signal}).then(e=>e.json()).then(e=>{if(!e.success)throw Error(e.message);let t=e.body;t.keyword==x&&(S(t.results),y(!1))}).catch(e=>{if("AbortError"===e.name){console.log("Fetch aborted");return}console.log(e),E("An error occurred while searching.")}),()=>{e.abort()}},[x]);let _=()=>{f(!0),v(!1)},C=()=>{f(!1)};return(0,r.jsxs)("div",{className:"searchHolder ".concat("search"===t?"":"d-none"),children:[(0,r.jsxs)("div",{className:"searchbox d-flex flex-column",children:[(0,r.jsx)("input",{id:"search",type:"text",className:"form-control",placeholder:"Search keywords",value:l,onChange:e=>o(e.target.value),onFocus:e=>_(),onBlur:e=>C()}),i.length>0&&!g&&(0,r.jsx)("div",{ref:a,className:"options flex-column ".concat(d?"show":""),children:i.map((e,t)=>(0,r.jsx)("div",{className:"rounded",onClick:()=>{o(e),j(e),v(!0),C()},children:(0,r.jsx)("span",{children:e})},t))})]}),(0,r.jsxs)("div",{className:"d-flex justify-content-center flex-column align-items-center",children:[k&&(0,r.jsx)("div",{className:"alert alert-danger w-100",role:"alert",children:k}),!k&&N&&(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsx)(m.g,{icon:h.z1G,className:"fa-spin"})}),!k&&w.length>0&&w.map(e=>(0,r.jsxs)("div",{className:"result-wrapper rounded",children:[(0,r.jsxs)("div",{className:"result-item",children:[(0,r.jsx)("div",{className:"thumbnail",children:(0,r.jsx)("img",{className:"rounded",src:e.thumbnail,alt:"Track Thumbnail"})}),(0,r.jsxs)("div",{className:"track-info",children:[(0,r.jsx)("h5",{className:"track-title",children:(0,r.jsx)(u(),{href:"https://youtube.com".concat(e.url_suffix),target:"_blank",rel:"noopener noreferrer",children:e.title})}),(0,r.jsx)("p",{className:"artist-name text-truncate",children:e.channel}),(0,r.jsx)("span",{className:"track-description",children:e.long_desc})]})]}),(0,r.jsxs)("div",{className:"text-end",children:[(0,r.jsx)(p,{roomID:s,searchResult:e}),(0,r.jsx)(b,{roomID:s,searchResult:e})]})]},e.id))]})]})}var v=s(3401),N=s(1469),y=s(6365);function w(){let[e,t]=(0,n.useState)({}),[s,a]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let{socket:e,unsubscribe:s}=(0,N.A)("/job","*",()=>{o(!0),a(null)},e=>{a(e),o(!1)});return e.on("progress",e=>{let s=y.C.fromJSON(e);t(e=>({...e,[s.jid]:s})),o(!1)}),()=>{s()}},[]),s)?(0,r.jsx)("div",{className:"alert alert-danger w-100",role:"alert",children:s}):(0,r.jsxs)("div",{children:[l?(0,r.jsx)("div",{className:"d-flex justify-content-center align-items-center my-2",children:(0,r.jsx)(m.g,{icon:h.z1G,spin:!0,size:"2x"})}):0===Object.keys(e).length&&(0,r.jsx)("div",{className:"alert alert-info w-100",role:"alert",children:"No jobs found."}),(0,r.jsx)("table",{className:"table table-striped table-hover text-center",style:{tableLayout:"fixed"},children:(0,r.jsx)("tbody",{children:Object.values(e).map(e=>(0,r.jsx)("tr",{children:(0,r.jsx)("td",{children:(0,r.jsxs)("div",{className:"d-flex align-items-center",children:[(0,r.jsx)("span",{title:e.status,className:"p-2",children:(0,v.cR)(e.status)}),(0,r.jsx)(u(),{className:"text-decoration-none overflow-hidden",href:"/job?jobId=".concat(e.jid),children:(0,r.jsx)("div",{className:"text-truncate",children:e.media.metadata.title||e.jid})})]})})},e.jid))})})]})}var S=s(8560),k=s(5464),E=s(5717),_=s.n(E);s(2732),s(9523),s(5410);let C={search:{title:"Search"},youtube:{title:"YouTube Link"},file:{title:"Local file"},progress:{title:"Progress"}};function I(){let e=(0,a.useSearchParams)(),t=(0,n.useRef)(null),[s,l]=(0,n.useState)("search"),[c,u]=(0,n.useState)(!1),[d,m]=(0,n.useState)(!0),h=e.get("roomID"),[f,x]=(0,n.useState)(null),{roomID:j,setRoomID:b}=(0,k.y)({encodedRoomID:h}),[p,v]=(0,n.useState)(0),N=e=>{l(e),m(!1),window.location.hash="#".concat(e),setTimeout(()=>{m(!0)},100)};return(0,n.useEffect)(()=>{let e=()=>{let e=window.location.hash;e&&"#search"===e&&l("search")};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}},[]),(0,r.jsxs)("div",{className:"root flex-column",children:[(0,r.jsx)("h1",{className:"mb-4 text-primary",children:"Welcome to JTV!"}),(0,r.jsxs)("div",{className:_().main,children:[(0,r.jsx)(S.A,{kareokeRoomModel:f,setKareokeRoomModel:x,roomID:j,setRoomID:b,version:p,setVersion:v}),(0,r.jsxs)("div",{className:"".concat(_()["action-panel"]," d-flex flex-column shadow rounded"),children:[(0,r.jsx)("ul",{className:"nav nav-tabs mb-1 flex-nowrap text-nowrap overflow-x-auto overflow-y-hidden",children:Object.entries(C).map(e=>{let[t,{title:n}]=e;return(0,r.jsx)("li",{className:"nav-item",style:{cursor:c?"not-allowed":"pointer"},children:(0,r.jsx)("button",{className:"nav-link ".concat(s===t?"active":""),onClick:()=>N(t),disabled:c,children:n})},t)})}),(0,r.jsxs)("div",{className:"position-relative",children:[(0,r.jsx)("form",{ref:t,onSubmit:e=>{e.preventDefault()},children:(0,r.jsxs)("div",{className:"tab-pane fade active ".concat(d?"show":""),children:[(0,r.jsx)(g,{activeTab:s,roomID:j}),"youtube"===s&&(0,r.jsx)(o,{setIsProcessing:u,isProcessing:c}),"file"===s&&(0,r.jsx)(i,{setIsProcessing:u,isProcessing:c}),"progress"===s&&(0,r.jsx)(w,{})]})}),c&&(0,r.jsx)("div",{className:"position-absolute w-100 h-100 top-0 start-0",style:{cursor:"wait"}})]})]})]})]})}},4089:(e,t,s)=>{Promise.resolve().then(s.bind(s,2918))},5717:e=>{e.exports={main:"page_main__nw1Wk","action-panel":"page_action-panel__pVj1D"}},9523:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[760,154,266,799,500,105,707,441,684,358],()=>t(4089)),_N_E=e.O()}]);