(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{1637:()=>{},2971:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(5155),s=a(2115),r=a(5799);function l(e){let{videoId:t,shouldPlay:a,onPlayerReady:l,onPlayerStateChange:i,onStateChange:o,onInfoUpdate:c}=e,[d,u]=(0,s.useState)(!1),[f,m]=(0,s.useState)(null),p=(0,s.useRef)(null);function h(e){e.target.unMute(),l&&l(e)}return(0,s.useEffect)(()=>{var e=document.createElement("script");return e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e),window.onYouTubeIframeAPIReady=function(){u(!0)},window.YT&&window.YT.Player&&u(!0),()=>{window.onYouTubeIframeAPIReady=void 0,e&&e.remove()}},[]),(0,s.useEffect)(()=>{if(!a)return;let e=setInterval(()=>{let t=p.current;if(t){if(t.getPlayerState()===YT.PlayerState.PLAYING){clearInterval(e),f&&(m(null),r.oR.dismiss(f));return}f||m(r.oR.warn("Please interact with the page to start playback.",{autoClose:!1,closeOnClick:!1})),t.playVideo()}},1e3);return()=>{console.log("clearing interval"),clearInterval(e),f&&(m(null),r.oR.dismiss(f))}},[f,a]),(0,s.useEffect)(()=>{if(d){var e=new YT.Player("player",{videoId:t,playerVars:{playsinline:1,disablekb:1,fs:0,mute:0},events:{onReady:h,onStateChange:i}});p.current=e;var a=e.getIframe().contentWindow;return window.addEventListener("message",n),()=>{p.current&&(p.current=null,e.destroy()),window.removeEventListener("message",n)}}function n(e){if(e.source===a){var t=JSON.parse(e.data);"infoDelivery"===t.event&&t.info&&c&&c(t.info)}}},[t,d]),(0,s.useEffect)(()=>{if(!o)return;let e=p.current;e&&e.playVideo&&o(e)}),(0,n.jsx)("div",{className:"h-100 w-100",children:(0,n.jsx)("div",{id:"player"})})}},3073:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var n=a(5155),s=a(2115),r=a(2971);function l(e){let{videoId:t,shouldPlay:a,audioUrl:l,subtitles:i,onPlayerReady:o,onPlayerStateChange:c,onStateChange:d,onInfoUpdate:u}=e,[f,m]=(0,s.useState)(i),[p,h]=(0,s.useState)(0),g=s.useRef(null),x=s.useRef(null),v=s.useRef(null);function y(){let e=x.current;e&&e.play().then(()=>{var e;null===(e=g.current)||void 0===e||e.mute()}).catch(e=>{e.name})}function j(e){let t=v.current;if(!t)return;let a=t.clientWidth,n=t.clientHeight,{font_size:s,x:r,y:l,alignX:i,alignY:o,bottom:c}=e;var d={};s&&(d.fontSize=s*a/1.5+"px"),"center"===i?(d.left="50%",d.transform="translateX(-50%)"):"left"===i?r&&(d.left=(r||0)*a+"px"):"right"===i&&r&&(d.right=(1-(r||0))*a+"px");let u=0;return n>a&&(u=n/4),"top"===o?l&&(d.top=(l||0)*a-u+"px"):"bottom"===o?l&&(d.bottom=(l||0)*a+u+"px"):"center"===o&&(d.top=(n-(c||0)*a)/2+(l||0)*a-u+"px"),d}return(0,s.useEffect)(()=>{let e=p+.5;m(i.filter(t=>e>=t.start&&e<=t.end));let t=v.current;if(!t)return;let a=t.querySelectorAll(".word");for(let t=0;t<a.length;t++){let n=a[t],s=n.querySelector(".fg"),r=parseFloat(n.dataset.start||"0"),l=parseFloat(n.dataset.end||"0")-r,i=Math.max(0,Math.min(1,Math.max(0,e-r)/l));s.style.width=100*i+"%"}},[p,i]),(0,s.useEffect)(()=>{function e(){let e=v.current;if(!e)return;let t=e.querySelectorAll(".subtitle");for(let e=0;e<t.length;e++){let a=t[e],n=a.dataset.fontSize,s=a.dataset.x,r=a.dataset.y,l=a.dataset.bottom,i=a.dataset.alignX,o=a.dataset.alignY,c=j({font_size:n?parseFloat(n):void 0,x:s?parseFloat(s):void 0,y:r?parseFloat(r):void 0,bottom:l?parseFloat(l):void 0,alignX:i,alignY:o});for(let e in c){let t=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();a.style.setProperty(t,c[e])}}}return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]),(0,n.jsxs)("div",{ref:v,className:"ktv-player",children:[l&&(0,n.jsx)("audio",{onLoadedData:function(){let e=g.current;e&&e.getPlayerState()===YT.PlayerState.PLAYING&&y()},ref:x,className:"d-none",controls:!0,src:l}),(0,n.jsx)(r.A,{videoId:t,shouldPlay:a,onPlayerReady:function(e){g.current=e.target,o&&o(e)},onStateChange:function(e){d&&d(e)},onInfoUpdate:function(e){u&&u(e);let t=x.current;t&&(e.currentTime&&(Math.abs(t.currentTime-e.currentTime)>.5&&(t.currentTime=e.currentTime),h(e.currentTime)),e.volume&&(t.volume=e.volume/100),void 0!==e.muted&&(t.muted=!e.muted))},onPlayerStateChange:function(e){c&&c(e);let t=x.current;t&&(e.data===YT.PlayerState.PLAYING?y():e.data===YT.PlayerState.PAUSED&&t.pause())}}),f.map((e,t)=>(0,n.jsx)("div",{className:"subtitle",style:j(e),"data-align-x":e.alignX,"data-align-y":e.alignY,"data-x":e.x,"data-y":e.y,"data-bottom":e.bottom,"data-font-size":e.font_size,children:e.words.map((e,t)=>(0,n.jsxs)("div",{className:"word","data-start":e.start,"data-end":e.end,children:[(0,n.jsx)("span",{className:"bg",children:e.text}),(0,n.jsx)("span",{className:"fg",style:{width:0},children:e.text})]},t))},e.x+":"+e.y+":"+e.start))]})}},3653:e=>{e.exports={"ktv-room":"page_ktv-room__sgSYc","video-container":"page_video-container__GDD3q",open:"page_open__dT68j","toggle-playlist-icon":"page_toggle-playlist-icon__iwccV","room-info":"page_room-info__wK8VH"}},5121:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_});var n=a(5155),s=a(2115),r=a(5695),l=a(7489),i=a(3578),o=a(559),c=a(2971),d=a(6874),u=a.n(d),f=a(3073),m=a(6365),p=a(1469),h=a(6472),g=a(4463),x=a(3401);let v={start:0,end:900,alignX:"center",alignY:"bottom",y:.9/15*.33,font_size:.9/15,words:[{start:0,end:0,text:"Generating lyrics..."}]},y={...v,words:[{start:0,end:0,text:"Failed to generate lyrics"}]};function j(e){let{jobId:t,shouldPlay:a,onPlayerReady:r,onPlayerStateChange:o,onStateChange:c}=e,[d,j]=(0,s.useState)(null),[b,w]=(0,s.useState)(null),[S,N]=(0,s.useState)(null),[_,P]=(0,s.useState)([v]),[I,E]=(0,s.useState)(null),R=(0,h.y)(b,E),k=d?new URL(d.media.source).searchParams.get("v"):null;(0,s.useEffect)(()=>{if(!t)return;let{socket:e,unsubscribe:a}=(0,p.A)("/job",t,()=>{E(null),j(null)},e=>{E(e),j(null)});return e.on("progress",e=>{E(null),j(m.C.fromJSON(e))}),()=>{a()}},[t]),(0,s.useEffect)(()=>{d&&(k||E("Invalid video ID"),d.artifact_tags.Instrumental?N("/api/artifact/".concat(d.jid,"/").concat(d.artifact_tags.Instrumental)):d.isRunning()||E("Conversion failed"),d.artifact_tags.subtitles?w("/api/artifact/".concat(d.jid,"/").concat(d.artifact_tags.subtitles)):d.isRunning()||P([y]))},[d]),(0,s.useEffect)(()=>{R&&P(JSON.parse(R))},[R]);let T=t?(0,n.jsxs)("p",{className:"mt-3",children:["Job ID: ",(0,n.jsx)(u(),{className:"text-decoration-none",href:"/job?jobId=".concat(t),target:"_blank",children:t})]}):null;return I?(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2 text-danger",children:[(0,n.jsx)(l.g,{icon:i.s0Q,size:"3x"}),(0,n.jsx)("h3",{className:"p-3",children:I}),T]}):d?S?k&&(0,n.jsx)(f.A,{videoId:k,shouldPlay:a,audioUrl:S,subtitles:_,onPlayerReady:r,onPlayerStateChange:o,onStateChange:c}):b?(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2",children:[(0,n.jsx)(l.g,{icon:i.z1G,spin:!0,size:"3x"}),(0,n.jsx)("h3",{className:"p-3",children:"Loading Subtitles..."}),T]}):(0,n.jsxs)("div",{className:"d-flex flex-column justify-content-center align-items-center p-2",children:[(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center p-2",children:[(0,x.cR)(d.status),(0,n.jsx)("div",{className:"p-2",children:(0,g.Zr)(d.status)})]}),T,(0,n.jsx)("div",{className:"player-progress-container d-flex h-50 overflow-hidden",children:(0,n.jsx)("div",{className:"player-progress-holder h-100",children:(0,n.jsx)("table",{className:"table table-striped table-hover text-center w-auto",style:{transform:"translateY(-".concat(Math.min(Object.values(d.tasks).length,...Object.values(d.tasks).map((e,t)=>["pending","queued","running","interrupted"].includes(e.status)?t:-1).filter(e=>-1!==e))/Object.values(d.tasks).length*100,"%)")},children:(0,n.jsx)("tbody",{children:Object.values(d.tasks).map(e=>(0,n.jsx)("tr",{children:(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"d-flex align-items-center",children:[(0,n.jsx)("span",{title:e.status,className:"p-2",children:(0,x.cR)(e.status)}),(0,n.jsx)("div",{className:"text-truncate",children:e.name})]})})},e.tid))})})})})]}):(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2",children:[(0,n.jsx)(l.g,{icon:i.z1G,spin:!0,size:"3x"}),(0,n.jsx)("h3",{className:"p-3",children:"Loading Job Info..."}),T]})}var b=a(5464),w=a(3653),S=a.n(w);a(1637),a(2732),a(5410),a(9331),a(8605);let N=e=>{let{kareokeRoomModel:t,item:a}=e,[r,l]=(0,s.useState)(!1);function i(e){r&&e.target.playVideo()}function o(e){e.data==YT.PlayerState.ENDED&&(null==t||t.moveToNextItem())}function d(e){t&&e&&e.playVideo&&(r?e.playVideo():e.pauseVideo())}switch((0,s.useEffect)(()=>{t&&(t.is_playing?l(!0):l(!1))}),a.type){case"youtube":return(0,n.jsx)(c.A,{videoId:a.identifier,shouldPlay:r,onStateChange:d,onPlayerReady:i,onPlayerStateChange:o},a.item_id);case"schedule":return(0,n.jsx)(j,{jobId:a.identifier,shouldPlay:r,onStateChange:d,onPlayerReady:i,onPlayerStateChange:o},a.item_id);default:return(0,n.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:"Your version of JTV does not support this video type."})}};function _(){var e;let t=(0,r.useSearchParams)().get("roomID"),[a,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),{roomID:f,setRoomID:m}=(0,b.y)({encodedRoomID:t}),[p,h]=(0,s.useState)(0);return(0,n.jsxs)("div",{className:S()["ktv-room"],children:[(0,n.jsxs)("div",{className:"".concat(S()["video-container"]," ").concat(a?S().open:""),children:[!d&&(0,n.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,n.jsx)(l.g,{icon:i.z1G,spin:!0,size:"2x"})}),(null==d?void 0:null===(e=d.playlist)||void 0===e?void 0:e[0])?(0,n.jsx)(N,{kareokeRoomModel:d,item:d.playlist[0]}):(0,n.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,n.jsx)(l.g,{icon:i.M6O,bounce:!0,size:"2x"})}),(0,n.jsx)("button",{className:S()["toggle-playlist-icon"],onClick:()=>c(!a),children:a?"✕":"☰"})]}),(0,n.jsx)("div",{className:"".concat(S()["room-info"]),children:(0,n.jsx)(o.A,{kareokeRoomModel:d,setKareokeRoomModel:u,roomID:f,setRoomID:m,version:p,setVersion:h})})]})}},6472:(e,t,a)=>{"use strict";a.d(t,{y:()=>s});var n=a(2115);function s(e,t,a){let[s,r]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return;let n=new AbortController;return fetch(e,{signal:n.signal}).then(e=>e.json().catch(()=>{throw Error(e.statusText||"Failed to parse response: "+e.status.toString())})).then(e=>{if(!e.success)throw Error(e.message);r(e.body),a&&a(!1)}).catch(e=>{"AbortError"!==e.name&&(t(e.message),a&&a(!1))}),()=>{n.abort()}},[e]),s}},6579:(e,t,a)=>{Promise.resolve().then(a.bind(a,5121))},8605:()=>{},9331:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[719,760,138,868,266,799,500,105,44,441,684,358],()=>t(6579)),_N_E=e.O()}]);