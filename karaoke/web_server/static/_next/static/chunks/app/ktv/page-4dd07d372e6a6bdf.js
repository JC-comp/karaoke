(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[642],{1637:()=>{},3653:e=>{e.exports={"ktv-room":"page_ktv-room__sgSYc","video-container":"page_video-container__GDD3q",open:"page_open__dT68j","toggle-playlist-icon":"page_toggle-playlist-icon__iwccV","room-info":"page_room-info__wK8VH"}},6472:(e,t,n)=>{"use strict";n.d(t,{y:()=>l});var s=n(2115);function l(e,t,n){let[l,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!e)return;let s=new AbortController;return fetch(e,{signal:s.signal}).then(e=>e.json().catch(()=>{throw Error(e.statusText)})).then(e=>{if(!e.success)throw Error(e.message);a(e.body),n&&n(!1)}).catch(e=>{"AbortError"!==e.name&&(t(e.message),n&&n(!1))}),()=>{s.abort()}},[e]),l}},6579:(e,t,n)=>{Promise.resolve().then(n.bind(n,9073))},9073:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>b});var s=n(5155),l=n(2115),a=n(5695),i=n(7489),r=n(3578),o=n(8560);function c(e){let{kareokeRoomModel:t,videoId:n}=e,[a,i]=(0,l.useState)(!1),r=(0,l.useRef)(null);return(0,l.useEffect)(()=>{var e=document.createElement("script");return e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e),window.onYouTubeIframeAPIReady=function(){i(!0)},window.YT&&window.YT.Player&&i(!0),()=>{window.onYouTubeIframeAPIReady=void 0,e&&e.remove()}},[]),(0,l.useEffect)(()=>{if(a){var e=new YT.Player("player",{videoId:n,playerVars:{playsinline:1},events:{onReady:function(e){(null==t?void 0:t.is_playing)&&e.target.playVideo()},onStateChange:function(e){e.data==YT.PlayerState.ENDED&&(null==t||t.moveToNextItem())}}});return r.current=e,()=>{r.current&&(r.current=null,e.destroy())}}},[n,a]),(0,l.useEffect)(()=>{if(!t)return;let e=r.current;e&&e.playVideo&&(t.is_playing?e.playVideo():e.pauseVideo())}),(0,s.jsx)("div",{id:"player-container",children:(0,s.jsx)("div",{id:"player"})})}var d=n(6874),u=n.n(d),f=n(1469),m=n(6365),p=n(6472),x=n(4463),h=n(3401),v=n(5799);function j(e){let{kareokeRoomModel:t,jobId:n}=e,a=(0,l.useRef)(null),[o,c]=(0,l.useState)(null),[d,j]=(0,l.useState)(null),[g,y]=(0,l.useState)(null),[N,_]=(0,l.useState)(null),[b,w]=(0,l.useState)(null),k=(0,p.y)(d,_);(0,l.useEffect)(()=>{if(!n)return;let{socket:e,unsubscribe:t}=(0,f.A)("/job",n,()=>{_(null),c(null)},e=>{_(e),c(null)});return e.on("progress",e=>{_(null),c(m.C.fromJSON(e))}),()=>{t()}},[n]),(0,l.useEffect)(()=>{o&&!(o.result_artifact_index<0)&&j("/api/artifact/".concat(o.jid,"/plain/").concat(o.result_artifact_index))},[o]),(0,l.useEffect)(()=>{if(!k||!o)return;let e=JSON.parse(k);y("/api/artifact/".concat(o.jid,"/file/").concat(e.result))},[k]),(0,l.useEffect)(()=>{if(!t)return;let e=a.current;e&&(b||(t.is_playing?e.play().catch(()=>{E()}):e.pause()))}),(0,l.useEffect)(()=>{if(null==b)return;let e=setInterval(()=>{if((null==t?void 0:t.is_playing)===!1)v.oR.dismiss(b),w(null);else{var e;null===(e=a.current)||void 0===e||e.play().then(()=>{v.oR.dismiss(b),w(null)}).catch(()=>{})}},1e3);return()=>{clearInterval(e)}},[b]);let E=()=>{let e=a.current;e&&!b&&(null==t?void 0:t.is_playing)&&e.play().catch(e=>{"NotAllowedError"===e.name&&w(v.oR.warn("Please interact with the page to start playback.",{autoClose:!1,closeOnClick:!1}))})},I=n?(0,s.jsxs)("p",{className:"mt-3",children:["Job ID: ",(0,s.jsx)(u(),{className:"text-decoration-none",href:"/job?jobId=".concat(n),target:"_blank",children:n})]}):null;return N?(0,s.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2 text-danger",children:[(0,s.jsx)(i.g,{icon:r.s0Q,size:"3x"}),(0,s.jsx)("h3",{className:"p-3",children:N}),I]}):o?g?g&&(0,s.jsxs)("video",{ref:a,className:"w-100",controls:!0,onError:()=>_("Failed to load video"),onLoadedData:E,onEnded:()=>null==t?void 0:t.moveToNextItem(),children:[(0,s.jsx)("source",{src:g,type:"video/mp4"}),"Your browser does not support the video tag."]}):d?(0,s.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2",children:[(0,s.jsx)(i.g,{icon:r.z1G,spin:!0,size:"3x"}),(0,s.jsx)("h3",{className:"p-3",children:"Loading Video..."}),I]}):0==Object.keys(o.tasks).length?(0,s.jsxs)("div",{className:"d-flex flex-column justify-content-center align-items-center p-2",children:[(0,s.jsxs)("div",{className:"d-flex justify-content-center align-items-center p-2",children:[(0,h.cR)(o.status),(0,s.jsx)("div",{className:"p-2",children:(0,x.Zr)(o.status)})]}),(0,s.jsx)("div",{children:"Waiting for conversion to finish..."}),I]}):(0,s.jsxs)("div",{className:"d-flex flex-column align-items-center justify-content-center",children:[I,(0,s.jsx)("div",{className:"player-progress-container d-flex h-50 overflow-hidden",children:(0,s.jsx)("div",{className:"player-progress-holder h-100",children:(0,s.jsx)("table",{className:"table table-striped table-hover text-center w-auto",style:{transform:"translateY(-".concat(Math.min(Object.values(o.tasks).length,...Object.values(o.tasks).map((e,t)=>["pending","queued","running","interrupted"].includes(e.status)?t:-1).filter(e=>-1!==e))/Object.values(o.tasks).length*100,"%)")},children:(0,s.jsx)("tbody",{children:Object.values(o.tasks).map(e=>(0,s.jsx)("tr",{children:(0,s.jsx)("td",{children:(0,s.jsxs)("div",{className:"d-flex align-items-center",children:[(0,s.jsx)("span",{title:e.status,className:"p-2",children:(0,h.cR)(e.status)}),(0,s.jsx)("div",{className:"text-truncate",children:e.name})]})})},e.tid))})})})})]}):(0,s.jsxs)("div",{className:"d-flex justify-content-center align-items-center flex-column p-2",children:[(0,s.jsx)(i.g,{icon:r.z1G,spin:!0,size:"3x"}),(0,s.jsx)("h3",{className:"p-3",children:"Loading Job Info..."}),I]})}var g=n(5464),y=n(3653),N=n.n(y);n(1637),n(2732),n(5410),n(9331);let _=e=>{let{kareokeRoomModel:t,item:n}=e;switch(n.type){case"youtube":return(0,s.jsx)(c,{kareokeRoomModel:t,videoId:n.identifier},n.item_id);case"schedule":return(0,s.jsx)(j,{kareokeRoomModel:t,jobId:n.identifier},n.item_id);default:return(0,s.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:"Your version of JTV does not support this video type."})}};function b(){var e;let t=(0,a.useSearchParams)().get("roomID"),[n,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(null),{roomID:f,setRoomID:m}=(0,g.y)({encodedRoomID:t}),[p,x]=(0,l.useState)(0);return(0,s.jsxs)("div",{className:N()["ktv-room"],children:[(0,s.jsxs)("div",{className:"".concat(N()["video-container"]," ").concat(n?N().open:""),children:[!d&&(0,s.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,s.jsx)(i.g,{icon:r.z1G,spin:!0,size:"2x"})}),(null==d?void 0:null===(e=d.playlist)||void 0===e?void 0:e[0])?(0,s.jsx)(_,{kareokeRoomModel:d,item:d.playlist[0]}):(0,s.jsx)("div",{className:"d-flex justify-content-center align-items-center",children:(0,s.jsx)(i.g,{icon:r.M6O,bounce:!0,size:"2x"})}),(0,s.jsx)("button",{className:N()["toggle-playlist-icon"],onClick:()=>c(!n),children:n?"✕":"☰"})]}),(0,s.jsx)("div",{className:"".concat(N()["room-info"]," ").concat(n?"":"d-none"),children:(0,s.jsx)(o.A,{kareokeRoomModel:d,setKareokeRoomModel:u,roomID:f,setRoomID:m,version:p,setVersion:x})})]})}},9331:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[719,760,138,266,799,500,105,707,441,684,358],()=>t(6579)),_N_E=e.O()}]);