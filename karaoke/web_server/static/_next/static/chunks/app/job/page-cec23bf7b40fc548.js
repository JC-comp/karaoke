(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[978],{1469:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var n=s(4298);let i=(e,t,s,i,r)=>{let a=(0,n.io)(e,{transports:["websocket"],path:"/ws"});var o=null;let l=()=>{o&&clearTimeout(o),o=setTimeout(()=>{s(),a.connect()},3e3)},c=()=>{o&&clearTimeout(o),o=setTimeout(()=>{s(),a.emit("join",t)},3e3)};return a.on("connect",()=>{console.log("WebSocket connection opened"),s(),a.emit("join",t)}),a.on("disconnect",e=>{"io server disconnect"===e&&(i("Server disconnected the socket"),l())}),a.on("error",e=>{i(e.message),a.emit("leave",t),c()}),a.on("connect_error",e=>{console.log("Connection error:",e),i("Connection error: "+e.message),l()}),a.on("joined",e=>{r&&r()}),{socket:a,unsubscribe:()=>{a.off("connect"),a.off("progress"),a.off("disconnect"),a.off("error"),a.off("connect_error"),a.off("joined"),o&&clearTimeout(o),a.disconnect()}}}},2971:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(5155),i=s(2115),r=s(5799);function a(e){let{videoId:t,shouldPlay:s,onPlayerReady:a,onPlayerStateChange:o,onStateChange:l,onInfoUpdate:c}=e,[d,u]=(0,i.useState)(!1),[h,m]=(0,i.useState)(null),g=(0,i.useRef)(null);function p(e){e.target.unMute(),a&&a(e)}return(0,i.useEffect)(()=>{var e=document.createElement("script");return e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e),window.onYouTubeIframeAPIReady=function(){u(!0)},window.YT&&window.YT.Player&&u(!0),()=>{window.onYouTubeIframeAPIReady=void 0,e&&e.remove()}},[]),(0,i.useEffect)(()=>{if(!s)return;let e=setInterval(()=>{let t=g.current;if(t){if(t.getPlayerState()===YT.PlayerState.PLAYING){clearInterval(e),h&&(m(null),r.oR.dismiss(h));return}h||m(r.oR.warn("Please interact with the page to start playback.",{autoClose:!1,closeOnClick:!1})),t.playVideo()}},1e3);return()=>{console.log("clearing interval"),clearInterval(e),h&&(m(null),r.oR.dismiss(h))}},[h,s]),(0,i.useEffect)(()=>{if(d){var e=new YT.Player("player",{videoId:t,playerVars:{playsinline:1,disablekb:1,fs:0,mute:0},events:{onReady:p,onStateChange:o}});g.current=e;var s=e.getIframe().contentWindow;return window.addEventListener("message",n),()=>{g.current&&(g.current=null,e.destroy()),window.removeEventListener("message",n)}}function n(e){if(e.source===s){var t=JSON.parse(e.data);"infoDelivery"===t.event&&t.info&&c&&c(t.info)}}},[t,d]),(0,i.useEffect)(()=>{if(!l)return;let e=g.current;e&&e.playVideo&&l(e)}),(0,n.jsx)("div",{className:"h-100 w-100",children:(0,n.jsx)("div",{id:"player"})})}},3073:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(5155),i=s(2115),r=s(2971);function a(e){let{videoId:t,shouldPlay:s,audioUrl:a,subtitles:o,onPlayerReady:l,onPlayerStateChange:c,onStateChange:d,onInfoUpdate:u}=e,[h,m]=(0,i.useState)(o),[g,p]=(0,i.useState)(0),f=i.useRef(null),v=i.useRef(null),x=i.useRef(null);function b(){let e=v.current;e&&e.play().then(()=>{var e;null===(e=f.current)||void 0===e||e.mute()}).catch(e=>{e.name})}function j(e){let t=x.current;if(!t)return;let s=t.clientWidth,n=t.clientHeight,{font_size:i,x:r,y:a,alignX:o,alignY:l,bottom:c}=e;var d={};i&&(d.fontSize=i*s/1.5+"px"),"center"===o?(d.left="50%",d.transform="translateX(-50%)"):"left"===o?r&&(d.left=(r||0)*s+"px"):"right"===o&&r&&(d.right=(1-(r||0))*s+"px");let u=0;return n>s&&(u=n/4),"top"===l?a&&(d.top=(a||0)*s-u+"px"):"bottom"===l?a&&(d.bottom=(a||0)*s+u+"px"):"center"===l&&(d.top=(n-(c||0)*s)/2+(a||0)*s-u+"px"),d}return(0,i.useEffect)(()=>{let e=g+.5;m(o.filter(t=>e>=t.start&&e<=t.end));let t=x.current;if(!t)return;let s=t.querySelectorAll(".word");for(let t=0;t<s.length;t++){let n=s[t],i=n.querySelector(".fg"),r=parseFloat(n.dataset.start||"0"),a=parseFloat(n.dataset.end||"0")-r,o=Math.max(0,Math.min(1,Math.max(0,e-r)/a));i.style.width=100*o+"%"}},[g,o]),(0,i.useEffect)(()=>{function e(){let e=x.current;if(!e)return;let t=e.querySelectorAll(".subtitle");for(let e=0;e<t.length;e++){let s=t[e],n=s.dataset.fontSize,i=s.dataset.x,r=s.dataset.y,a=s.dataset.bottom,o=s.dataset.alignX,l=s.dataset.alignY,c=j({font_size:n?parseFloat(n):void 0,x:i?parseFloat(i):void 0,y:r?parseFloat(r):void 0,bottom:a?parseFloat(a):void 0,alignX:o,alignY:l});for(let e in c){let t=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();s.style.setProperty(t,c[e])}}}return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]),(0,n.jsxs)("div",{ref:x,className:"ktv-player",children:[a&&(0,n.jsx)("audio",{onLoadedData:function(){let e=f.current;e&&e.getPlayerState()===YT.PlayerState.PLAYING&&b()},ref:v,className:"d-none",controls:!0,src:a}),(0,n.jsx)(r.A,{videoId:t,shouldPlay:s,onPlayerReady:function(e){f.current=e.target,l&&l(e)},onStateChange:function(e){d&&d(e)},onInfoUpdate:function(e){u&&u(e);let t=v.current;t&&(e.currentTime&&(Math.abs(t.currentTime-e.currentTime)>.5&&(t.currentTime=e.currentTime),p(e.currentTime)),e.volume&&(t.volume=e.volume/100),void 0!==e.muted&&(t.muted=!e.muted))},onPlayerStateChange:function(e){c&&c(e);let t=v.current;t&&(e.data===YT.PlayerState.PLAYING?b():e.data===YT.PlayerState.PAUSED&&t.pause())}}),h.map((e,t)=>(0,n.jsx)("div",{className:"subtitle",style:j(e),"data-align-x":e.alignX,"data-align-y":e.alignY,"data-x":e.x,"data-y":e.y,"data-bottom":e.bottom,"data-font-size":e.font_size,children:e.words.map((e,t)=>(0,n.jsxs)("div",{className:"word","data-start":e.start,"data-end":e.end,children:[(0,n.jsx)("span",{className:"bg",children:e.text}),(0,n.jsx)("span",{className:"fg",style:{width:0},children:e.text})]},t))},e.x+":"+e.y+":"+e.start))]})}},3401:(e,t,s)=>{"use strict";s.d(t,{cR:()=>l,qY:()=>a});var n=s(5155),i=s(7489),r=s(3578);let a=e=>{switch(e){case"pending":case"soft_failed":case"skipped":return"text-warning";case"queued":case"interrupting":return"text-info";case"created":case"running":return"text-primary";case"completed":return"text-success";case"failed":case"canceled":case"interrupted":return"text-danger";default:return""}},o=e=>{switch(e){case"running":return{spin:!0};case"queued":case"created":case"interrupting":return{fade:!0};default:return{}}},l=e=>{var t;switch(e){case"pending":t=r.SVv;break;case"queued":t=r.Exz;break;case"created":t=r.CQO;break;case"running":t=r.z1G;break;case"completed":t=r.SGM;break;case"soft_failed":t=r.lEd;break;case"failed":t=r.s0Q;break;case"skipped":t=r.vFJ;break;case"interrupting":t=r.APi;break;case"canceled":t=r.Dfk;break;case"interrupted":t=r.bFI;break;default:t=null}return t?(0,n.jsx)(i.g,{icon:t,...o(e),className:a(e)}):null}},3808:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Y});var n=s(5155),i=s(2115),r=s(5695),a=s(8242),o=s.n(a),l=s(7489),c=s(3578),d=s(5799),u=s(4058);function h(e){let{url:t,plugins:s,onDecode:r,setIsLoading:a,setError:o}=e,[l,c]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(l||!t)return;o(null),a(!0);let e=new AbortController;return fetch(t,{signal:e.signal}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.blob()}).then(e=>{c(URL.createObjectURL(e)),a(!1)}).catch(e=>{if("AbortError"===e.name){console.log("Fetch aborted");return}o("Failed to load audio: "+e.message)}),()=>{e.abort()}},[t]),l&&(0,n.jsx)(u.A,{url:l,mediaControls:!0,plugins:s,onDecode:e=>{r&&r(e)},onError:()=>o("Failed to load audio")})}var m=s(1828),g=s(6472);function p(e){let{url:t,setIsLoading:s,setError:r}=e,a=(0,g.y)(t,r,s),[o,l]=(0,i.useState)(null);return(0,i.useEffect)(()=>{a&&l(JSON.parse(a))},[a]),o&&(0,n.jsx)("table",{className:"table table-bordered table-striped table-hover m-0",children:(0,n.jsx)("tbody",{children:Object.entries(o).map(e=>{let[t,s]=e;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"text-truncate",children:t}),(0,n.jsx)("td",{className:"text-truncate",children:JSON.stringify(s)})]},t)})})})}function f(e){let{url:t,setIsLoading:s,setError:r}=e,a=(0,g.y)(t,r,s),[o,l]=(0,i.useState)(null);return(0,i.useEffect)(()=>{l(a)},[a]),o&&(0,n.jsx)("div",{className:"overflow-auto",children:(0,n.jsx)("pre",{className:"m-0 p-2 text-break",children:o})})}var v=s(2233),x=s(2089),b=s(9461),j=s(266);class w extends b.A{clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){let e=this.start===this.end;this.element.setAttribute("part","".concat(e?"marker":"region"," ").concat(this.id))}addResizeHandles(e){let t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},s=(0,j.A)("div",{part:"region-handle region-handle-left",style:{...t,left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"}},e),n=(0,j.A)("div",{part:"region-handle region-handle-right",style:{...t,right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"}},e);this.subscriptions.push((0,x.e)(s,e=>this.onResize(e,"start"),()=>null,()=>this.onEndResizing(),1),(0,x.e)(n,e=>this.onResize(e,"end"),()=>null,()=>this.onEndResizing(),1))}removeResizeHandles(e){let t=e.querySelector('[part*="region-handle-left"]'),s=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),s&&e.removeChild(s)}initElement(){let e=this.start===this.end,t=0,s=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(t=(s=100/this.numberOfChannels)*this.channelIdx);let n=(0,j.A)("div",{style:{position:"absolute",top:"".concat(t,"%"),height:"".concat(s,"%"),backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(n),n}renderPosition(){let e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left="".concat(100*e,"%"),this.element.style.right="".concat(100*t,"%")}toggleCursor(e){var t;this.drag&&(null===(t=this.element)||void 0===t?void 0:t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){let{element:e}=this;e&&(e.addEventListener("click",e=>this.emit("click",e)),e.addEventListener("mouseenter",e=>this.emit("over",e)),e.addEventListener("mouseleave",e=>this.emit("leave",e)),e.addEventListener("dblclick",e=>this.emit("dblclick",e)),e.addEventListener("pointerdown",()=>this.toggleCursor(!0)),e.addEventListener("pointerup",()=>this.toggleCursor(!1)),this.subscriptions.push((0,x.e)(e,e=>this.onMove(e),()=>this.toggleCursor(!0),()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")})),this.contentEditable&&this.content&&(this.content.addEventListener("click",e=>this.onContentClick(e)),this.content.addEventListener("blur",()=>this.onContentBlur())))}_onUpdate(e,t){if(!this.element.parentElement)return;let{width:s}=this.element.parentElement.getBoundingClientRect(),n=e/s*this.totalDuration,i=t&&"start"!==t?this.start:this.start+n,r=t&&"end"!==t?this.end:this.end+n,a=r-i;i>=0&&r<=this.totalDuration&&i<=r&&a>=this.minLength&&a<=this.maxLength&&(this.start=i,this.end=r,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||"start"!==t)&&(this.resizeEnd||"end"!==t)&&this._onUpdate(e,t)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}setContent(e){var t;if(null===(t=this.content)||void 0===t||t.remove(),!e){this.content=void 0;return}if("string"==typeof e){let t=this.start===this.end;this.content=(0,j.A)("div",{style:{padding:"0.2em ".concat(t?.2:.4,"em"),display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content)}setOptions(e){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),void 0!==e.drag&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),void 0!==e.start||void 0!==e.end){var t,s;let n=this.start===this.end;this.start=this.clampPosition(null!==(t=e.start)&&void 0!==t?t:this.start),this.end=this.clampPosition(null!==(s=e.end)&&void 0!==s?s:n?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),void 0!==e.resize&&e.resize!==this.resize){let t=this.start===this.end;this.resize=e.resize,this.resize&&!t?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}void 0!==e.resizeStart&&(this.resizeStart=e.resizeStart),void 0!==e.resizeEnd&&(this.resizeEnd=e.resizeEnd)}remove(){this.emit("remove"),this.subscriptions.forEach(e=>e()),this.element.remove(),this.element=null}constructor(e,t,s=0){var n,i,r,a,o,l,c,d,u,h;super(),this.totalDuration=t,this.numberOfChannels=s,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.subscriptions=[],this.id=e.id||"region-".concat(Math.random().toString(32).slice(2)),this.start=this.clampPosition(e.start),this.end=this.clampPosition(null!==(n=e.end)&&void 0!==n?n:e.start),this.drag=null===(i=e.drag)||void 0===i||i,this.resize=null===(r=e.resize)||void 0===r||r,this.resizeStart=null===(a=e.resizeStart)||void 0===a||a,this.resizeEnd=null===(o=e.resizeEnd)||void 0===o||o,this.color=null!==(l=e.color)&&void 0!==l?l:"rgba(0, 0, 0, 0.1)",this.minLength=null!==(c=e.minLength)&&void 0!==c?c:this.minLength,this.maxLength=null!==(d=e.maxLength)&&void 0!==d?d:this.maxLength,this.channelIdx=null!==(u=e.channelIdx)&&void 0!==u?u:-1,this.contentEditable=null!==(h=e.contentEditable)&&void 0!==h?h:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}}class y extends v.A{static create(e){return new y(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{let s=this.regions.filter(e=>e.start<=t&&(e.end===e.start?e.start+.05:e.end)>=t);s.forEach(t=>{e.includes(t)||this.emit("region-in",t)}),e.forEach(e=>{s.includes(e)||this.emit("region-out",e)}),e=s}),this.wavesurfer.on("zoom",()=>{this.onZoomTimeout&&clearTimeout(this.onZoomTimeout),this.onZoomTimeout=setTimeout(()=>{let e=this.regions.filter(e=>e.element.parentElement&&e.content);e.forEach(e=>{var t;null===(t=e.content)||void 0===t||t.setAttribute("data-computed","false")}),e.forEach(e=>{this.avoidOverlapping(e)})},1e3)}))}initRegionsContainer(){return(0,j.A)("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.content&&setTimeout(()=>{if(!(null===(o=e.element)||void 0===o?void 0:o.parentElement))return;this.reRenderTimeout&&clearTimeout(this.reRenderTimeout),this.reRenderTimeout=setTimeout(()=>{var e;let t=Math.max(128,...this.regions.map(e=>{if(!e.content||!(null===(t=e.element)||void 0===t?void 0:t.parentElement))return 0;var t,s=parseFloat(e.content.style.top||"0");return s+e.content.getBoundingClientRect().height}));null===(e=this.wavesurfer)||void 0===e||e.setOptions({height:t})},1e3);let s=e.content,n=s.getBoundingClientRect();if(t>10){s.dataset.computed="true";return}let i=this.regions.filter(t=>{var s;return t!==e&&(null===(s=t.element)||void 0===s?void 0:s.parentElement)&&t.content}),r=i.filter(t=>t!==e&&(t.start<e.start||t.start==e.start&&t.id<e.id)),a=i.filter(t=>t!==e&&(t.start>e.start||t.start==e.start&&t.id>e.id));var o,l=0===(r.length?r:a).filter(e=>void 0!==e.content&&"true"!==e.content.dataset.computed).length;if(0!==r.length||l||(l=!0),!l){setTimeout(()=>this.avoidOverlapping(e,t+1),10);return}for(var c=1,d=0;c>0;)(c=Math.max(...r.map(t=>{if(t===e||!t.content)return 0;let s=t.content.getBoundingClientRect();return n.bottom+d<=s.top||n.top+d>=s.bottom?0:n.left<s.left+s.width&&s.left<n.left+n.width?s.height+s.top-(n.top+d):0})))>0&&(d+=c);if(d>0){let e=parseFloat(s.style.top||"0")+.1+d;s.style.top="".concat(e,"px")}s.dataset.computed="true",a.filter(e=>{var t;return(null===(t=e.content)||void 0===t?void 0:t.dataset.computed)==="true"}).forEach(t=>{if(t===e||!t.content)return;let s=t.content.getBoundingClientRect();!(n.bottom+d<=s.top)&&!(n.top+d>=s.bottom)&&n.left<s.left+s.width&&s.left<n.left+n.width&&(t.content.style.top="0",t.content.setAttribute("data-computed","false"),this.avoidOverlapping(t))})},10)}adjustScroll(e){var t,s;let n=null===(s=this.wavesurfer)||void 0===s?void 0:null===(t=s.getWrapper())||void 0===t?void 0:t.parentElement;if(!n)return;let{clientWidth:i,scrollWidth:r}=n;if(r<=i)return;let a=n.getBoundingClientRect(),o=e.element.getBoundingClientRect(),l=o.left-a.left,c=o.right-a.left;l<0?n.scrollLeft+=l:c>i&&(n.scrollLeft+=c-i)}virtualAppend(e,t,s){let n=()=>{if(!this.wavesurfer)return;let n=this.wavesurfer.getWidth(),i=this.wavesurfer.getScroll(),r=t.clientWidth,a=this.wavesurfer.getDuration(),o=Math.round(e.start/a*r),l=o+(Math.round((e.end-e.start)/a*r)||1)>i&&o<i+n;if(l&&!s.parentElement)t.appendChild(s),setTimeout(()=>{this.avoidOverlapping(e)},0);else if(!l&&s.parentElement){let t=e.content;t&&(t.setAttribute("data-computed","false"),t.style.top="0px"),s.remove()}};setTimeout(()=>{if(!this.wavesurfer)return;n();let t=this.wavesurfer.on("scroll",n);this.subscriptions.push(e.once("remove",t),t);let s=this.wavesurfer.on("redraw",n);this.subscriptions.push(s)},0)}saveRegion(e){this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);let t=[e.on("update",t=>{t||this.adjustScroll(e),this.emit("region-update",e,t)}),e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",t=>{var s;null===(s=this.wavesurfer)||void 0===s||s.play(e.start,t)}),e.on("click",t=>{this.emit("region-clicked",e,t)}),e.on("dblclick",t=>{this.emit("region-double-clicked",e,t)}),e.once("remove",()=>{t.forEach(e=>e()),this.regions=this.regions.filter(t=>t!==e),this.emit("region-removed",e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,s;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let n=this.wavesurfer.getDuration(),i=new w(e,n,null===(s=this.wavesurfer)||void 0===s?void 0:null===(t=s.getDecodedData())||void 0===t?void 0:t.numberOfChannels);return n?this.saveRegion(i):this.subscriptions.push(this.wavesurfer.once("ready",e=>{i._setTotalDuration(e),this.saveRegion(i)})),i}enableDragSelection(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=null===(t=this.wavesurfer)||void 0===t?void 0:t.getWrapper();if(!n||!(n instanceof HTMLElement))return()=>void 0;let i=null,r=0;return(0,x.e)(n,(e,t,s)=>{i&&i._onUpdate(e,s>r?"end":"start")},t=>{var s,n;if(r=t,!this.wavesurfer)return;let a=this.wavesurfer.getDuration(),o=null===(n=this.wavesurfer)||void 0===n?void 0:null===(s=n.getDecodedData())||void 0===s?void 0:s.numberOfChannels,{width:l}=this.wavesurfer.getWrapper().getBoundingClientRect();i=new w({...e,start:t/l*a,end:(t+5)/l*a},a,o),this.regionsContainer.appendChild(i.element)},()=>{i&&(this.saveRegion(i),i=null)},s)}clearRegions(){this.regions.slice().forEach(e=>e.remove()),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}constructor(e){super(e),this.regions=[],this.reRenderTimeout=null,this.onZoomTimeout=null,this.regionsContainer=this.initRegionsContainer(),this.reRenderTimeout=null,this.onZoomTimeout=null}}function E(e){let{url:t,jobId:s,setIsLoading:r,setError:a}=e,o=(0,g.y)(t,a),[l,c]=(0,i.useState)([]),[d,u]=(0,i.useState)(null),[p,f]=(0,i.useState)([y.create(),m.A.create({scale:.01})]);return(0,i.useEffect)(()=>{if(!o)return;let e=JSON.parse(o);c(e.segments),u("/api/artifact/".concat(s,"/").concat(e.audio))},[o]),(0,n.jsx)("div",{children:(0,n.jsx)("div",{children:(0,n.jsx)(h,{url:d,plugins:p,onDecode:function(e){let t=p[0];t.clearRegions(),l.forEach((s,n)=>{let i=void 0===s.original_start?s.start:s.original_start,r=s.text||s.word||s.words&&s.words.reduce((e,t,s)=>0===s?t:/^[\x00-\x7F]*$/.test(t)?e+" "+t:e+t,""),a=void 0===r?void 0:document.createElement("div");a&&(r&&(a.innerText=r),a.style.zIndex="6",a.addEventListener("click",t=>{t.stopPropagation(),e.seekTo(i/e.getDuration())})),t.addRegion({id:n.toString(),start:i,end:void 0===s.original_end?s.end:s.original_end,content:a,drag:!1,resize:!1})}),t.on("region-in",e=>{e.setOptions({color:"rgba(0, 0, 0, 0.4)"}),e.content&&(e.content.style.color="var(--bs-primary-text-emphasis)",e.content.style.backgroundColor="rgba(0, 0, 0, 0.4)",e.content.style.fontWeight="bold")}),t.on("region-out",e=>{e.setOptions({color:"rgba(0, 0, 0, 0.1)"}),e.content&&(e.content.style.color="",e.content.style.backgroundColor="",e.content.style.fontWeight="")})},setIsLoading:r,setError:a})})})}function N(e){let{artifact:t,jobId:s,setIsLoading:i,setError:r}=e,a="/api/artifact/".concat(s,"/").concat(t.aid);switch(t.artifact_type){case"video":return(0,n.jsxs)("video",{controls:!0,className:"w-100",onLoadedData:()=>i(!1),onError:()=>r("Failed to load video"),children:[(0,n.jsx)("source",{src:a,type:"video/mp4"}),"Your browser does not support the video tag."]});case"audio":return(0,n.jsx)("div",{children:(0,n.jsx)(h,{url:a,plugins:[m.A.create({scale:.01})],setIsLoading:i,setError:r})});case"json":return(0,n.jsx)(p,{url:a,setIsLoading:i,setError:r});case"text":return(0,n.jsx)(f,{url:a,setIsLoading:i,setError:r});case"segments":return(0,n.jsx)(E,{url:a,jobId:s,setIsLoading:i,setError:r});default:return i(!1),(0,n.jsx)("span",{className:"text-muted",children:"Preview not available"})}}function S(e){let{artifact:t,jobId:s}=e,[r,a]=(0,i.useState)(!0),[o,d]=(0,i.useState)(null);return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{scope:"row",children:t.name}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"position-relative",children:[!o&&(0,n.jsx)(N,{artifact:t,jobId:s,setIsLoading:a,setError:d}),!o&&r&&(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center m-auto flex-column position-absolute h-100 w-100 top-0 start-0 z-2",children:[(0,n.jsx)(l.g,{icon:c.z1G,className:"text-primary",spin:!0}),(0,n.jsx)("span",{className:"text-muted",children:"Loading..."})]}),o&&(0,n.jsxs)("div",{className:"d-flex justify-content-center align-items-center m-auto flex-column",children:[(0,n.jsx)(l.g,{icon:c.s0Q,className:"text-danger"}),(0,n.jsx)("span",{className:"text-danger",children:o})]})]})})]},t.aid)}function k(e){let{task:t,jobId:s}=e,[r,a]=(0,i.useState)(!1),o=i.createRef();return(0,n.jsxs)("details",{ref:o,className:"log-details",onToggle:()=>{var e;return a((null===(e=o.current)||void 0===e?void 0:e.open)||!1)},children:[(0,n.jsx)("summary",{className:"rounded",children:"Task Artifacts"}),r&&(0,n.jsxs)("table",{className:"table table-striped table-hover artifact-table",children:[(0,n.jsxs)("colgroup",{children:[(0,n.jsx)("col",{span:1,style:{width:"20%"}}),(0,n.jsx)("col",{span:1,style:{width:"80%"}})]}),(0,n.jsx)("tbody",{children:t.artifacts.filter(e=>!e.is_attached).map(e=>(0,n.jsx)(S,{artifact:e,jobId:s},e.aid))})]})]})}s(7580);var C=s(3073);function R(e){let{jobInfo:t}=e,[s,r]=(0,i.useState)(!0),[a,o]=(0,i.useState)(null),[d,u]=(0,i.useState)([]),[h,m]=(0,i.useState)(null),[p,f]=(0,i.useState)(null),v=(0,g.y)(p,o),x=new URL(t.media.source).searchParams.get("v");return((0,i.useEffect)(()=>{v&&(u(JSON.parse(v)),r(!1))},[v]),(0,i.useEffect)(()=>{x||o("Invalid video ID")},[]),(0,i.useEffect)(()=>{t.artifact_tags.Instrumental&&m("/api/artifact/".concat(t.jid,"/").concat(t.artifact_tags.Instrumental)),t.artifact_tags.subtitles&&f("/api/artifact/".concat(t.jid,"/").concat(t.artifact_tags.subtitles)),t.isRunning()||("subtitles"in t.artifact_tags||o("Subtitles are not generated for this job"),"Instrumental"in t.artifact_tags||o("Instrumental is not generated for this job"))},[t]),a)?(0,n.jsxs)("div",{className:"text-center text-danger",children:[(0,n.jsx)(l.g,{icon:c.s0Q}),(0,n.jsx)("p",{children:a})]}):t.isRunning()?(0,n.jsx)("div",{className:"text-center text-primary",children:(0,n.jsx)(l.g,{icon:c.G1Y,bounce:!0})}):s?(0,n.jsx)("div",{className:"d-flex justify-content-center align-items-center m-auto flex-column position-absolute h-100 w-100 top-0 start-0 z-2",children:(0,n.jsx)(l.g,{icon:c.z1G,spin:!0})}):x&&h&&(0,n.jsx)(C.A,{shouldPlay:!1,videoId:x,audioUrl:h,subtitles:d})}var _=s(8359);function z(e){let{jobInfo:t}=e;return(0,n.jsxs)("div",{className:"btn-group mx-2",role:"group","aria-label":"Basic example",children:[(0,n.jsx)(_.A,{className:"btn btn-secondary disabled",icon:(0,n.jsx)(l.g,{icon:c.ijD}),onClick:()=>new Promise(e=>{setTimeout(e,1e3)}),children:null}),(0,n.jsx)(_.A,{className:"btn btn-secondary disabled",icon:(0,n.jsx)(l.g,{icon:c.G1Y}),onClick:()=>new Promise(e=>{setTimeout(e,1e3)}),children:null}),(0,n.jsx)(_.A,{className:"btn ".concat(t.isRunning()?"btn-primary":"btn-secondary disabled"),icon:(0,n.jsx)(l.g,{icon:c.APi}),onClick:()=>(function(e){let s=new FormData;return s.append("action",e),fetch("/api/job/".concat(t.jid),{method:"POST",body:s}).then(e=>e.json().catch(()=>{throw Error(e.statusText||"Failed to parse response: "+e.status.toString())})).then(e=>{if(!e.success)throw Error(e.message)}).catch(e=>{d.oR.error(e.message)})})("stop"),children:null})]})}var T=s(6365),I=s(1469),A=s(3401);let L=(e,t)=>{let s=new Date(e);return new Date(Math.abs(new Date(t).getTime()-s.getTime())).toISOString().substring(11,22)},P=(e,t)=>L(1e3*e,1e3*t);var O=s(4463),D=s(7665),M=s.n(D);function F(e){window.document.querySelectorAll("details").forEach(e=>{e.open&&e.removeAttribute("open")})}s(5685),s(5796),s(6653),s(8605);let Y=()=>{let e=(0,r.useRouter)(),t=(0,r.useSearchParams)().get("jobId"),[s,a]=(0,i.useState)(null),u=function(e){let t=(0,i.useRef)(null);return(0,i.useEffect)(()=>{t.current=e}),t.current}(s),[h,m]=(0,i.useState)(null),[g,p]=(0,i.useState)(!1);if(!t){d.oR.error("Job ID is missing"),e.push("/");return}(0,i.useEffect)(()=>{s&&u&&u.status!==s.status&&d.oR.info("Job status changed to ".concat(s.status))},[s]),(0,i.useEffect)(()=>{let{socket:e,unsubscribe:s}=(0,I.A)("/job",t,()=>{m(null),a(null)},e=>{m(e),a(null)});return e.on("progress",e=>{m(null),a(T.C.fromJSON(e))}),()=>{s()}},[t]);let f=()=>{window.history.state.key?e.back():e.push("/")};function v(e,s,i,r){return(0,n.jsxs)("div",{className:"root flex-column text-center",children:[(0,n.jsx)(l.g,{icon:r,className:"".concat(s," mb-3"),size:"3x",spin:i}),(0,n.jsx)("p",{className:"lead",children:e}),(0,n.jsxs)("p",{className:"mt-3",children:["Job ID: ",t]}),(0,n.jsx)("button",{className:"btn btn-outline-info btn-lg",onClick:f,children:"Back"})]})}return((0,i.useEffect)(()=>{let e=()=>{p(null!==document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]),h)?v(h,"text-danger",!1,c.s0Q):null==s?v("Loading job information...","",!0,c.z1G):(0,n.jsxs)("div",{className:"container-fluid d-flex flex-column h-100 p-3",children:[(0,n.jsxs)("div",{className:"d-flex flex-row justify-content-between align-items-center mb-3",children:[(0,n.jsx)("button",{className:"btn btn-outline-info btn-lg",onClick:f,children:"Back"}),(0,n.jsxs)("span",{className:"text-start flex-grow-1 px-3",children:["Job: ",t]})]}),(0,n.jsxs)("div",{className:"".concat(M()["progress-row"]),children:[(0,n.jsxs)("div",{className:"col-md-4 overflow-auto",children:[(0,n.jsx)("div",{className:"card",children:(0,n.jsxs)("div",{className:"card-body",children:[(0,n.jsx)("h5",{className:"card-title",children:"Job Information"}),(0,n.jsxs)("ul",{className:"list-group list-group-flush",children:[(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Created At:"})," ",(0,n.jsx)(o(),{fromNow:!0,withTitle:!0,date:1e3*s.created_at})]}),s.started_at&&(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Queued: "}),P(s.started_at,s.created_at)]}),s.started_at&&s.finished_at&&(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Duration: "}),P(s.started_at,s.finished_at)]}),(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Status:"})," ",(0,A.cR)(s.status)," ",(0,O.Zr)(s.status)]}),(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Action:"}),(0,n.jsx)(z,{jobInfo:s})]}),(0,n.jsx)("li",{className:"list-group-item",children:(0,n.jsxs)("div",{className:"d-flex flex-column w-100 h-100",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Result:"}),(0,n.jsx)("button",{className:"btn btn-outline-info btn-sm mx-2",onClick:function(e){for(var t=e.currentTarget.parentElement;t&&"LI"!==t.tagName;)t=t.parentElement;document.fullscreenElement?document.exitFullscreen():t&&t.requestFullscreen()},children:(0,n.jsx)(l.g,{icon:g?c.gr3:c.oZK,size:"sm"})})]}),(0,n.jsx)("div",{className:"flex-grow-1",children:(0,n.jsx)(R,{jobInfo:s})})]})})]})]})}),(0,n.jsx)("div",{className:"card",children:(0,n.jsxs)("div",{className:"card-body",children:[(0,n.jsx)("h5",{className:"card-title",children:"Media Metadata"}),(0,n.jsxs)("ul",{className:"list-group list-group-flush",children:[(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"ID:"})," ",s.media.metadata.id]}),(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Source:"})," ",s.media.source]}),(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Title:"})," ",s.media.metadata.title]}),(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Channel:"})," ",s.media.metadata.channel]}),(0,n.jsxs)("li",{className:"list-group-item",children:[(0,n.jsx)("strong",{children:"Duration:"})," ",s.media.metadata.duration?s.media.metadata.duration+" seconds":""]})]})]})})]}),(0,n.jsx)("div",{className:"col-md-8 overflow-auto",children:Object.keys(s.tasks).length>0?(0,n.jsx)("div",{className:"accordion",id:"accordionTasks",children:Object.values(s.tasks).map(e=>(0,n.jsxs)("div",{className:"accordion-item",children:[(0,n.jsx)("div",{className:"accordion-header",id:"heading".concat(e.tid),children:(0,n.jsxs)("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse".concat(e.tid),"aria-expanded":"false","aria-controls":"collapse".concat(e.tid),onClick:F,children:[(0,A.cR)(e.status),(0,n.jsx)("span",{className:"".concat(M()["status-text"]," badge ").concat((0,A.qY)(e.status)," flex-shrink-0"),children:(0,O.Zr)(e.status)}),(0,n.jsxs)("div",{className:"d-flex flex-column overflow-hidden",children:[(0,n.jsxs)("span",{children:[e.hasArtifact()&&(0,n.jsx)(l.g,{icon:c.WMI,className:"me-2"}),e.name]}),(0,n.jsx)("span",{className:"text-truncate badge bg-secondary mw-100",title:e.message,style:{marginInlineEnd:"auto",whiteSpace:"pre"},children:e.message})]})]})}),(0,n.jsx)("div",{id:"collapse".concat(e.tid),className:"accordion-collapse collapse","aria-labelledby":"heading".concat(e.tid),"data-bs-parent":"#accordionTasks",children:(0,n.jsx)("div",{className:"accordion-body",children:(0,n.jsxs)("div",{className:"d-flex flex-column",children:[e.hasArtifact()&&(0,n.jsx)(k,{task:e,jobId:t}),(0,n.jsx)("div",{className:M()["log-body"],children:0===e.output.length?(0,n.jsx)("div",{className:"text-center text-muted",children:"No logs available"}):function(e){let t=e.split("\n"),s=RegExp("^(\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2},\\d{3}) - (\\d+) - ([^ ]+) - ([^ ]+) - (.*)$","s"),i=t.reduce((e,t)=>{let n=t.match(s);if(n){let t=n[1].replace(",","."),s=n[2],i=n[3],r=n[4],a=n[5].split("\r").reverse()[0];e.push({timestamp:t,pid:s,module:i,level:r,message:a})}return e},[]);return i.map((e,t)=>(0,n.jsxs)("div",{className:"d-flex flex-row ".concat(M()["log-line"]),children:[(0,n.jsx)("code",{className:M()["log-line-number"],children:t+1}),(0,n.jsxs)("code",{children:[(0,n.jsx)("span",{className:"user-select-none",title:e.timestamp,children:L(i[0].timestamp,e.timestamp)}),(0,n.jsxs)("span",{className:"user-select-none",children:["[",e.level,"]"]}),(0,n.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:e.message})]})]},t))}(e.output)})]})})})]},e.tid))}):(0,n.jsx)("div",{className:"card",children:(0,n.jsxs)("div",{className:"card-body",children:[(0,n.jsx)("h5",{className:"card-title",children:"No tasks available"}),(0,n.jsx)("p",{className:"card-text",children:"If the job is queued, it has to wait for the previous jobs to finish."})]})})})]})]})}},4255:(e,t,s)=>{Promise.resolve().then(s.bind(s,3808))},4463:(e,t,s)=>{"use strict";s.d(t,{Ok:()=>r,Zr:()=>o,h1:()=>a});var n=s(5799),i=s(5695);let r=(e,t)=>(null==t||t(!0),fetch("/api/create-job",{method:"POST",body:e}).then(e=>e.json().catch(()=>{throw Error(e.statusText)})).then(e=>{if(!e.success)throw Error(e.message);return e.body.jid}).finally(()=>{null==t||t(!1)})),a=()=>{let e=(0,i.useRouter)();return(t,s)=>{n.oR.info("Submitting data and retrieving job info...",{autoClose:!1,isLoading:!0,draggable:!1}),r(t,s).finally(()=>{n.oR.dismiss()}).then(t=>{n.oR.success("Job information retrieved successfully!",{autoClose:2e3}),e.push("/job?jobId=".concat(t))}).catch(e=>{n.oR.error("Failed to start job: ".concat((null==e?void 0:e.message)||e))})}};function o(e){return e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}},5796:()=>{},6365:(e,t,s)=>{"use strict";s.d(t,{C:()=>i});class n{hasArtifact(){for(let e of this.artifacts)if(!e.is_attached)return!0;return!1}static fromJSON(e){return new n(e.tid,e.name,e.status,e.message,e.output,e.artifacts)}constructor(e,t,s,n,i,r){this.tid=e,this.name=t,this.status=s,this.message=n,this.output=i,this.artifacts=r}}class i{isRunning(){switch(this.status){case"pending":case"queued":case"created":case"running":return!0;case"interrupting":case"interrupted":case"completed":case"failed":case"canceled":return!1}}static fromJSON(e){return new i(e.jid,e.created_at,e.started_at,e.finished_at,e.type,e.media,e.status,e.message,e.isProcessExited,e.artifact_tags,Object.fromEntries(Object.entries(e.tasks).map(e=>{let[t,s]=e;return[t,n.fromJSON(s)]})))}constructor(e,t,s,n,i,r,a,o,l,c,d){this.jid=e,this.created_at=t,this.started_at=s,this.finished_at=n,this.type=i,this.media=r,this.status=a,this.message=o,this.isProcessExited=l,this.artifact_tags=c,this.tasks=d}}},6472:(e,t,s)=>{"use strict";s.d(t,{y:()=>i});var n=s(2115);function i(e,t,s){let[i,r]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e)return;let n=new AbortController;return fetch(e,{signal:n.signal}).then(e=>e.json().catch(()=>{throw Error(e.statusText||"Failed to parse response: "+e.status.toString())})).then(e=>{if(!e.success)throw Error(e.message);r(e.body),s&&s(!1)}).catch(e=>{"AbortError"!==e.name&&(t(e.message),s&&s(!1))}),()=>{n.abort()}},[e]),i}},6653:()=>{},7580:()=>{},7665:e=>{e.exports={"progress-row":"page_progress-row__j55VT","log-line":"page_log-line__HyXNI","log-line-number":"page_log-line-number__9GnEG","log-body":"page_log-body__GQQeX","status-text":"page_status-text__UuCD2","region-content":"page_region-content__nk5ju"}},8359:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var n=s(5155),i=s(2115),r=s(7489),a=s(3578);function o(e){let{className:t,icon:s,children:o,onClick:l}=e,[c,d]=(0,i.useState)(!1);return(0,n.jsxs)("button",{className:t,onClick:()=>{d(!0),l().finally(()=>{d(!1)})},disabled:c,children:[c?(0,n.jsx)(r.g,{icon:a.z1G,spin:!0}):s,o&&(0,n.jsx)("span",{children:o})]})}},8605:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[74,740,936,868,266,586,799,500,328,441,684,358],()=>t(4255)),_N_E=e.O()}]);