(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[978],{1366:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var i=s(5155),n=s(2115),r=s(5695),a=s(8242),o=s.n(a),l=s(7489),c=s(3578),d=s(5799),u=s(4058),h=s(1828),m=s(6472);function p(e){let{url:t,setIsLoading:s,setError:r}=e,a=(0,m.y)(t,r,s),[o,l]=(0,n.useState)(null);return(0,n.useEffect)(()=>{a&&l(JSON.parse(a))},[a]),o&&(0,i.jsx)("table",{className:"table table-bordered table-striped table-hover m-0",children:(0,i.jsx)("tbody",{children:Object.entries(o).map(e=>{let[t,s]=e;return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"text-truncate",children:t}),(0,i.jsx)("td",{className:"text-truncate",children:s})]},t)})})})}function g(e){let{url:t,setIsLoading:s,setError:r}=e,a=(0,m.y)(t,r,s),[o,l]=(0,n.useState)(null);return(0,n.useEffect)(()=>{l(a)},[a]),o&&(0,i.jsx)("div",{className:"overflow-auto",children:(0,i.jsx)("pre",{className:"m-0 p-2 text-break",children:o})})}var f=s(2233),v=s(2089),x=s(9461),b=s(266);class j extends x.A{clampPosition(e){return Math.max(0,Math.min(this.totalDuration,e))}setPart(){let e=this.start===this.end;this.element.setAttribute("part","".concat(e?"marker":"region"," ").concat(this.id))}addResizeHandles(e){let t={position:"absolute",zIndex:"2",width:"6px",height:"100%",top:"0",cursor:"ew-resize",wordBreak:"keep-all"},s=(0,b.A)("div",{part:"region-handle region-handle-left",style:{...t,left:"0",borderLeft:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"2px 0 0 2px"}},e),i=(0,b.A)("div",{part:"region-handle region-handle-right",style:{...t,right:"0",borderRight:"2px solid rgba(0, 0, 0, 0.5)",borderRadius:"0 2px 2px 0"}},e);this.subscriptions.push((0,v.e)(s,e=>this.onResize(e,"start"),()=>null,()=>this.onEndResizing(),1),(0,v.e)(i,e=>this.onResize(e,"end"),()=>null,()=>this.onEndResizing(),1))}removeResizeHandles(e){let t=e.querySelector('[part*="region-handle-left"]'),s=e.querySelector('[part*="region-handle-right"]');t&&e.removeChild(t),s&&e.removeChild(s)}initElement(){let e=this.start===this.end,t=0,s=100;this.channelIdx>=0&&this.channelIdx<this.numberOfChannels&&(t=(s=100/this.numberOfChannels)*this.channelIdx);let i=(0,b.A)("div",{style:{position:"absolute",top:"".concat(t,"%"),height:"".concat(s,"%"),backgroundColor:e?"none":this.color,borderLeft:e?"2px solid "+this.color:"none",borderRadius:"2px",boxSizing:"border-box",transition:"background-color 0.2s ease",cursor:this.drag?"grab":"default",pointerEvents:"all"}});return!e&&this.resize&&this.addResizeHandles(i),i}renderPosition(){let e=this.start/this.totalDuration,t=(this.totalDuration-this.end)/this.totalDuration;this.element.style.left="".concat(100*e,"%"),this.element.style.right="".concat(100*t,"%")}toggleCursor(e){var t;this.drag&&(null===(t=this.element)||void 0===t?void 0:t.style)&&(this.element.style.cursor=e?"grabbing":"grab")}initMouseEvents(){let{element:e}=this;e&&(e.addEventListener("click",e=>this.emit("click",e)),e.addEventListener("mouseenter",e=>this.emit("over",e)),e.addEventListener("mouseleave",e=>this.emit("leave",e)),e.addEventListener("dblclick",e=>this.emit("dblclick",e)),e.addEventListener("pointerdown",()=>this.toggleCursor(!0)),e.addEventListener("pointerup",()=>this.toggleCursor(!1)),this.subscriptions.push((0,v.e)(e,e=>this.onMove(e),()=>this.toggleCursor(!0),()=>{this.toggleCursor(!1),this.drag&&this.emit("update-end")})),this.contentEditable&&this.content&&(this.content.addEventListener("click",e=>this.onContentClick(e)),this.content.addEventListener("blur",()=>this.onContentBlur())))}_onUpdate(e,t){if(!this.element.parentElement)return;let{width:s}=this.element.parentElement.getBoundingClientRect(),i=e/s*this.totalDuration,n=t&&"start"!==t?this.start:this.start+i,r=t&&"end"!==t?this.end:this.end+i,a=r-n;n>=0&&r<=this.totalDuration&&n<=r&&a>=this.minLength&&a<=this.maxLength&&(this.start=n,this.end=r,this.renderPosition(),this.emit("update",t))}onMove(e){this.drag&&this._onUpdate(e)}onResize(e,t){this.resize&&(this.resizeStart||"start"!==t)&&(this.resizeEnd||"end"!==t)&&this._onUpdate(e,t)}onEndResizing(){this.resize&&this.emit("update-end")}onContentClick(e){e.stopPropagation(),e.target.focus(),this.emit("click",e)}onContentBlur(){this.emit("update-end")}_setTotalDuration(e){this.totalDuration=e,this.renderPosition()}play(e){this.emit("play",e&&this.end!==this.start?this.end:void 0)}setContent(e){var t;if(null===(t=this.content)||void 0===t||t.remove(),!e){this.content=void 0;return}if("string"==typeof e){let t=this.start===this.end;this.content=(0,b.A)("div",{style:{padding:"0.2em ".concat(t?.2:.4,"em"),display:"inline-block"},textContent:e})}else this.content=e;this.contentEditable&&(this.content.contentEditable="true"),this.content.setAttribute("part","region-content"),this.element.appendChild(this.content)}setOptions(e){if(e.color&&(this.color=e.color,this.element.style.backgroundColor=this.color),void 0!==e.drag&&(this.drag=e.drag,this.element.style.cursor=this.drag?"grab":"default"),void 0!==e.start||void 0!==e.end){var t,s;let i=this.start===this.end;this.start=this.clampPosition(null!==(t=e.start)&&void 0!==t?t:this.start),this.end=this.clampPosition(null!==(s=e.end)&&void 0!==s?s:i?this.start:this.end),this.renderPosition(),this.setPart()}if(e.content&&this.setContent(e.content),e.id&&(this.id=e.id,this.setPart()),void 0!==e.resize&&e.resize!==this.resize){let t=this.start===this.end;this.resize=e.resize,this.resize&&!t?this.addResizeHandles(this.element):this.removeResizeHandles(this.element)}void 0!==e.resizeStart&&(this.resizeStart=e.resizeStart),void 0!==e.resizeEnd&&(this.resizeEnd=e.resizeEnd)}remove(){this.emit("remove"),this.subscriptions.forEach(e=>e()),this.element.remove(),this.element=null}constructor(e,t,s=0){var i,n,r,a,o,l,c,d,u,h;super(),this.totalDuration=t,this.numberOfChannels=s,this.minLength=0,this.maxLength=1/0,this.contentEditable=!1,this.subscriptions=[],this.subscriptions=[],this.id=e.id||"region-".concat(Math.random().toString(32).slice(2)),this.start=this.clampPosition(e.start),this.end=this.clampPosition(null!==(i=e.end)&&void 0!==i?i:e.start),this.drag=null===(n=e.drag)||void 0===n||n,this.resize=null===(r=e.resize)||void 0===r||r,this.resizeStart=null===(a=e.resizeStart)||void 0===a||a,this.resizeEnd=null===(o=e.resizeEnd)||void 0===o||o,this.color=null!==(l=e.color)&&void 0!==l?l:"rgba(0, 0, 0, 0.1)",this.minLength=null!==(c=e.minLength)&&void 0!==c?c:this.minLength,this.maxLength=null!==(d=e.maxLength)&&void 0!==d?d:this.maxLength,this.channelIdx=null!==(u=e.channelIdx)&&void 0!==u?u:-1,this.contentEditable=null!==(h=e.contentEditable)&&void 0!==h?h:this.contentEditable,this.element=this.initElement(),this.setContent(e.content),this.setPart(),this.renderPosition(),this.initMouseEvents()}}class w extends f.A{static create(e){return new w(e)}onInit(){if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");this.wavesurfer.getWrapper().appendChild(this.regionsContainer);let e=[];this.subscriptions.push(this.wavesurfer.on("timeupdate",t=>{let s=this.regions.filter(e=>e.start<=t&&(e.end===e.start?e.start+.05:e.end)>=t);s.forEach(t=>{e.includes(t)||this.emit("region-in",t)}),e.forEach(e=>{s.includes(e)||this.emit("region-out",e)}),e=s}),this.wavesurfer.on("zoom",()=>{this.onZoomTimeout&&clearTimeout(this.onZoomTimeout),this.onZoomTimeout=setTimeout(()=>{let e=this.regions.filter(e=>e.element.parentElement&&e.content);e.forEach(e=>{var t;null===(t=e.content)||void 0===t||t.setAttribute("data-computed","false")}),e.forEach(e=>{this.avoidOverlapping(e)})},1e3)}))}initRegionsContainer(){return(0,b.A)("div",{style:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",zIndex:"5",pointerEvents:"none"}})}getRegions(){return this.regions}avoidOverlapping(e){e.content&&setTimeout(()=>{if(!(null===(a=e.element)||void 0===a?void 0:a.parentElement))return;this.reRenderTimeout&&clearTimeout(this.reRenderTimeout),this.reRenderTimeout=setTimeout(()=>{var e;let t=Math.max(128,...this.regions.map(e=>{if(!e.content||!(null===(t=e.element)||void 0===t?void 0:t.parentElement))return 0;var t,s=parseFloat(e.content.style.top||"0");return s+e.content.getBoundingClientRect().height}));null===(e=this.wavesurfer)||void 0===e||e.setOptions({height:t})},1e3);let t=e.content,s=t.getBoundingClientRect(),i=this.regions.filter(t=>{var s;return t!==e&&(null===(s=t.element)||void 0===s?void 0:s.parentElement)&&t.content}),n=i.filter(t=>t!==e&&t.start<=e.start),r=i.filter(t=>t!==e&&t.start>e.start);var a,o=0===(n.length?n:r).filter(e=>void 0!==e.content&&"true"!==e.content.dataset.computed).length;if(0!==n.length||o||(o=!0),!o){setTimeout(()=>this.avoidOverlapping(e),10);return}for(var l=1,c=0;l>0;)(l=Math.max(...n.map(t=>{if(t===e||!t.content)return 0;let i=t.content.getBoundingClientRect();return s.bottom+c<=i.top||s.top+c>=i.bottom?0:s.left<i.left+i.width&&i.left<s.left+s.width?i.height+i.top-(s.top+c):0})))>0&&(c+=l);if(c>0){let e=parseFloat(t.style.top||"0")+.1+c;t.style.top="".concat(e,"px")}t.dataset.computed="true",r.filter(e=>{var t;return(null===(t=e.content)||void 0===t?void 0:t.dataset.computed)==="true"}).forEach(t=>{if(t===e||!t.content)return;let i=t.content.getBoundingClientRect();!(s.bottom+c<=i.top)&&!(s.top+c>=i.bottom)&&s.left<i.left+i.width&&i.left<s.left+s.width&&(t.content.style.top="0",t.content.setAttribute("data-computed","false"),this.avoidOverlapping(t))})},10)}adjustScroll(e){var t,s;let i=null===(s=this.wavesurfer)||void 0===s?void 0:null===(t=s.getWrapper())||void 0===t?void 0:t.parentElement;if(!i)return;let{clientWidth:n,scrollWidth:r}=i;if(r<=n)return;let a=i.getBoundingClientRect(),o=e.element.getBoundingClientRect(),l=o.left-a.left,c=o.right-a.left;l<0?i.scrollLeft+=l:c>n&&(i.scrollLeft+=c-n)}virtualAppend(e,t,s){let i=()=>{if(!this.wavesurfer)return;let i=this.wavesurfer.getWidth(),n=this.wavesurfer.getScroll(),r=t.clientWidth,a=this.wavesurfer.getDuration(),o=Math.round(e.start/a*r),l=o+(Math.round((e.end-e.start)/a*r)||1)>n&&o<n+i;if(l&&!s.parentElement)t.appendChild(s),setTimeout(()=>{this.avoidOverlapping(e)},0);else if(!l&&s.parentElement){let t=e.content;t&&(t.setAttribute("data-computed","false"),t.style.top="0px"),s.remove()}};setTimeout(()=>{if(!this.wavesurfer)return;i();let t=this.wavesurfer.on("scroll",i);this.subscriptions.push(e.once("remove",t),t);let s=this.wavesurfer.on("redraw",i);this.subscriptions.push(s)},0)}saveRegion(e){this.virtualAppend(e,this.regionsContainer,e.element),this.avoidOverlapping(e),this.regions.push(e);let t=[e.on("update",t=>{t||this.adjustScroll(e),this.emit("region-update",e,t)}),e.on("update-end",()=>{this.avoidOverlapping(e),this.emit("region-updated",e)}),e.on("play",t=>{var s;null===(s=this.wavesurfer)||void 0===s||s.play(e.start,t)}),e.on("click",t=>{this.emit("region-clicked",e,t)}),e.on("dblclick",t=>{this.emit("region-double-clicked",e,t)}),e.once("remove",()=>{t.forEach(e=>e()),this.regions=this.regions.filter(t=>t!==e),this.emit("region-removed",e)})];this.subscriptions.push(...t),this.emit("region-created",e)}addRegion(e){var t,s;if(!this.wavesurfer)throw Error("WaveSurfer is not initialized");let i=this.wavesurfer.getDuration(),n=new j(e,i,null===(s=this.wavesurfer)||void 0===s?void 0:null===(t=s.getDecodedData())||void 0===t?void 0:t.numberOfChannels);return i?this.saveRegion(n):this.subscriptions.push(this.wavesurfer.once("ready",e=>{n._setTotalDuration(e),this.saveRegion(n)})),n}enableDragSelection(e){var t;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=null===(t=this.wavesurfer)||void 0===t?void 0:t.getWrapper();if(!i||!(i instanceof HTMLElement))return()=>void 0;let n=null,r=0;return(0,v.e)(i,(e,t,s)=>{n&&n._onUpdate(e,s>r?"end":"start")},t=>{var s,i;if(r=t,!this.wavesurfer)return;let a=this.wavesurfer.getDuration(),o=null===(i=this.wavesurfer)||void 0===i?void 0:null===(s=i.getDecodedData())||void 0===s?void 0:s.numberOfChannels,{width:l}=this.wavesurfer.getWrapper().getBoundingClientRect();n=new j({...e,start:t/l*a,end:(t+5)/l*a},a,o),this.regionsContainer.appendChild(n.element)},()=>{n&&(this.saveRegion(n),n=null)},s)}clearRegions(){this.regions.slice().forEach(e=>e.remove()),this.regions=[]}destroy(){this.clearRegions(),super.destroy(),this.regionsContainer.remove()}constructor(e){super(e),this.regions=[],this.reRenderTimeout=null,this.onZoomTimeout=null,this.regionsContainer=this.initRegionsContainer(),this.reRenderTimeout=null,this.onZoomTimeout=null}}function E(e){let{url:t,jobId:s,setIsLoading:r,setError:a}=e,o=(0,m.y)(t,a),[l,c]=(0,n.useState)([]),[d,p]=(0,n.useState)(null),[g,f]=(0,n.useState)([w.create(),h.A.create({scale:.01})]);return(0,n.useEffect)(()=>{if(!o)return;let e=JSON.parse(o);c(e.segments),p("/api/artifact/".concat(s,"/file/").concat(e.audio))},[o]),d&&(0,i.jsx)("div",{children:(0,i.jsx)("div",{children:(0,i.jsx)(u.A,{url:d,mediaControls:!0,plugins:g,onDecode:function(e){let t=g[0];t.clearRegions(),l.forEach((s,i)=>{let n=void 0===s.original_start?s.start:s.original_start,r=void 0===(s.text||s.word)?void 0:document.createElement("div");r&&(r.innerText=s.text||s.word,r.style.zIndex="6",r.addEventListener("click",t=>{t.stopPropagation(),e.seekTo(n/e.getDuration())})),t.addRegion({id:i.toString(),start:n,end:void 0===s.original_end?s.end:s.original_end,content:r,drag:!1,resize:!1})}),t.on("region-in",e=>{e.setOptions({color:"rgba(0, 0, 0, 0.4)"}),e.content&&(e.content.style.color="var(--bs-primary-text-emphasis)",e.content.style.backgroundColor="rgba(0, 0, 0, 0.4)",e.content.style.fontWeight="bold")}),t.on("region-out",e=>{e.setOptions({color:"rgba(0, 0, 0, 0.1)"}),e.content&&(e.content.style.color="",e.content.style.backgroundColor="",e.content.style.fontWeight="")})},onReady:()=>r(!1),onError:()=>a("Failed to load audio")})})})}function N(e){let{artifact:t,jobId:s,setIsLoading:n,setError:r}=e,a=["video","audio"].includes(t.artifact_type)?"file":"plain",o="/api/artifact/".concat(s,"/").concat(a,"/").concat(t.aid);switch(t.artifact_type){case"video":return(0,i.jsxs)("video",{controls:!0,className:"w-100",onLoadedData:()=>n(!1),onError:()=>r("Failed to load video"),children:[(0,i.jsx)("source",{src:o,type:"video/mp4"}),"Your browser does not support the video tag."]});case"audio":return(0,i.jsx)("div",{children:(0,i.jsx)(u.A,{url:o,mediaControls:!0,plugins:[h.A.create({scale:.01})],onReady:()=>n(!1),onError:()=>r("Failed to load audio")})});case"json":return(0,i.jsx)(p,{url:o,setIsLoading:n,setError:r});case"text":return(0,i.jsx)(g,{url:o,setIsLoading:n,setError:r});case"segments":return(0,i.jsx)(E,{url:o,jobId:s,setIsLoading:n,setError:r});default:return n(!1),(0,i.jsx)("span",{className:"text-muted",children:"Preview not available"})}}function y(e){let{artifact:t,jobId:s}=e,[r,a]=(0,n.useState)(!0),[o,d]=(0,n.useState)(null);return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{scope:"row",children:t.name}),(0,i.jsx)("td",{children:(0,i.jsxs)("div",{className:"position-relative",children:[!o&&(0,i.jsx)(N,{artifact:t,jobId:s,setIsLoading:a,setError:d}),!o&&r&&(0,i.jsxs)("div",{className:"d-flex justify-content-center align-items-center m-auto flex-column position-absolute h-100 w-100 top-0 start-0 z-2",children:[(0,i.jsx)(l.g,{icon:c.z1G,className:"text-primary",spin:!0}),(0,i.jsx)("span",{className:"text-muted",children:"Loading..."})]}),o&&(0,i.jsxs)("div",{className:"d-flex justify-content-center align-items-center m-auto flex-column",children:[(0,i.jsx)(l.g,{icon:c.s0Q,className:"text-danger"}),(0,i.jsx)("span",{className:"text-danger",children:o})]})]})})]},t.aid)}function k(e){let{task:t,jobId:s}=e,[r,a]=(0,n.useState)(!1);return(0,i.jsxs)("details",{className:"log-details",onToggle:()=>a(!r),children:[(0,i.jsx)("summary",{className:"rounded",children:"Task Artifacts"}),r&&(0,i.jsxs)("table",{className:"table table-striped table-hover artifact-table",children:[(0,i.jsxs)("colgroup",{children:[(0,i.jsx)("col",{span:1,style:{width:"20%"}}),(0,i.jsx)("col",{span:1,style:{width:"80%"}})]}),(0,i.jsx)("tbody",{children:t.artifacts.filter(e=>!e.is_attached).map(e=>(0,i.jsx)(y,{artifact:e,jobId:s},e.aid))})]})]})}function C(e){let{jobInfo:t}=e,[s,r]=(0,n.useState)(!0),[a,o]=(0,n.useState)(null),[d,u]=(0,n.useState)(null),[h,p]=(0,n.useState)(null),[g,f]=(0,n.useState)(!1),v="/api/artifact/".concat(t.jid,"/plain/").concat(t.result_artifact_index),x=(0,m.y)(v,o),b=n.useRef(null),j=n.useRef(null);return(0,n.useEffect)(()=>{if(x){let e=JSON.parse(x);p("/api/artifact/".concat(t.jid,"/file/").concat(e.vocal)),u("/api/artifact/".concat(t.jid,"/file/").concat(e.result))}},[x]),(0,n.useEffect)(()=>{if(!b.current||!j.current)return;let e=b.current;j.current.currentTime=e.currentTime},[g]),(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Result:"}),(0,i.jsxs)("div",{className:"position-relative",children:[!a&&s&&(0,i.jsx)("div",{className:"d-flex justify-content-center align-items-center m-auto flex-column position-absolute h-100 w-100 top-0 start-0 z-2",children:(0,i.jsx)(l.g,{icon:c.z1G,spin:!0})}),a&&(0,i.jsxs)("div",{className:"text-center text-danger",children:[(0,i.jsx)(l.g,{icon:c.s0Q}),(0,i.jsx)("p",{children:a})]}),!a&&d&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("video",{ref:b,controls:!0,className:"w-100",onLoadedData:()=>r(!1),onError:()=>o("Failed to load video"),children:[(0,i.jsx)("source",{src:d,type:"video/mp4"}),"Your browser does not support the video tag."]}),!a&&!s&&(0,i.jsxs)("div",{className:"position-absolute top-0 end-0 me-4",children:[(0,i.jsx)("input",{id:"switch",type:"checkbox",className:"vocal-toggle",onChange:()=>f(!g)}),(0,i.jsx)("label",{htmlFor:"switch",className:"vocal-toggle-label",children:(0,i.jsx)("span",{"data-on":"Vocal","data-off":"Karaoke"})})]}),h&&(0,i.jsx)("audio",{muted:!g,ref:j,className:"d-none",controls:!0,src:h,onLoadedData:function(){if(!b.current||!j.current)return;let e=b.current,t=j.current;e.addEventListener("play",()=>{t.currentTime=e.currentTime,t.play()}),e.addEventListener("pause",()=>{t.pause()}),e.addEventListener("seeking",()=>{t.volume=0}),e.addEventListener("seeked",()=>{t.currentTime=e.currentTime,t.volume=e.volume}),e.addEventListener("volumechange",()=>{t.volume=e.volume})}})]})]})]})}s(7580);var _=s(6365),R=s(1469),S=s(3401);let z=(e,t)=>{let s=new Date(e);return new Date(Math.abs(new Date(t).getTime()-s.getTime())).toISOString().substring(11,22)},T=(e,t)=>z(1e3*e,1e3*t);var L=s(4463),O=s(7665),D=s.n(O);function A(e){window.document.querySelectorAll("details").forEach(e=>{e.open&&e.removeAttribute("open")})}s(5685),s(5796),s(6653);let I=()=>{let e=(0,r.useRouter)(),t=(0,r.useSearchParams)().get("jobId"),[s,a]=(0,n.useState)(null),u=function(e){let t=(0,n.useRef)(null);return(0,n.useEffect)(()=>{t.current=e}),t.current}(s),[h,m]=(0,n.useState)(null);if(!t){d.oR.error("Job ID is missing"),e.push("/");return}(0,n.useEffect)(()=>{u&&u.status!==(null==s?void 0:s.status)&&d.oR.info("Job status changed to ".concat(null==s?void 0:s.status))},[s]),(0,n.useEffect)(()=>{let{socket:e,unsubscribe:s}=(0,R.A)("/job",t,()=>{m(null),a(null)},e=>{m(e),a(null)});return e.on("progress",e=>{m(null),a(_.C.fromJSON(e))}),()=>{s()}},[t]);let p=()=>{window.history.state.key?e.back():e.push("/")};function g(e,s,n,r){return(0,i.jsxs)("div",{className:"root flex-column text-center",children:[(0,i.jsx)(l.g,{icon:r,className:"".concat(s," mb-3"),size:"3x",spin:n}),(0,i.jsx)("p",{className:"lead",children:e}),(0,i.jsxs)("p",{className:"mt-3",children:["Job ID: ",t]}),(0,i.jsx)("button",{className:"btn btn-outline-info btn-lg",onClick:p,children:"Back"})]})}return h?g(h,"text-danger",!1,c.s0Q):null==s?g("Loading job information...","",!0,c.z1G):(0,i.jsxs)("div",{className:"container-fluid d-flex flex-column h-100 p-3",children:[(0,i.jsxs)("div",{className:"d-flex flex-row justify-content-between align-items-center mb-3",children:[(0,i.jsx)("button",{className:"btn btn-outline-info btn-lg",onClick:p,children:"Back"}),(0,i.jsxs)("span",{className:"text-start flex-grow-1 px-3",children:["Job: ",t]})]}),(0,i.jsxs)("div",{className:"".concat(D()["progress-row"]),children:[(0,i.jsxs)("div",{className:"col-md-4 overflow-auto",children:[(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h5",{className:"card-title",children:"Job Information"}),(0,i.jsxs)("ul",{className:"list-group list-group-flush",children:[(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Created At:"})," ",(0,i.jsx)(o(),{fromNow:!0,withTitle:!0,date:1e3*s.created_at})]}),s.started_at&&(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Queued: "}),T(s.started_at,s.created_at)]}),s.started_at&&s.finished_at&&(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Duration: "}),T(s.started_at,s.finished_at)]}),(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Status:"})," ",(0,S.cR)(s.status)," ",(0,L.Zr)(s.status)]}),s.result_artifact_index>=0&&(0,i.jsx)(C,{jobInfo:s})]})]})}),(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h5",{className:"card-title",children:"Media Metadata"}),(0,i.jsxs)("ul",{className:"list-group list-group-flush",children:[(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"ID:"})," ",s.media.metadata.id]}),(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Source:"})," ",s.media.source]}),(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Title:"})," ",s.media.metadata.title]}),(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Channel:"})," ",s.media.metadata.channel]}),(0,i.jsxs)("li",{className:"list-group-item",children:[(0,i.jsx)("strong",{children:"Duration:"})," ",s.media.metadata.duration?s.media.metadata.duration+" seconds":""]})]})]})})]}),(0,i.jsx)("div",{className:"col-md-8 overflow-auto",children:Object.keys(s.tasks).length>0?(0,i.jsx)("div",{className:"accordion",id:"accordionTasks",children:Object.values(s.tasks).map(e=>(0,i.jsxs)("div",{className:"accordion-item",children:[(0,i.jsx)("div",{className:"accordion-header",id:"heading".concat(e.tid),children:(0,i.jsxs)("button",{className:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapse".concat(e.tid),"aria-expanded":"false","aria-controls":"collapse".concat(e.tid),onClick:A,children:[(0,S.cR)(e.status),(0,i.jsx)("span",{className:"".concat(D()["status-text"]," badge ").concat((0,S.qY)(e.status)," flex-shrink-0"),children:(0,L.Zr)(e.status)}),(0,i.jsxs)("div",{className:"d-flex flex-column overflow-hidden",children:[(0,i.jsxs)("span",{children:[e.hasArtifact()&&(0,i.jsx)(l.g,{icon:c.WMI,className:"me-2"}),e.name]}),(0,i.jsx)("span",{className:"text-truncate badge bg-secondary mw-100",title:e.message,style:{marginInlineEnd:"auto",whiteSpace:"pre"},children:e.message})]})]})}),(0,i.jsx)("div",{id:"collapse".concat(e.tid),className:"accordion-collapse collapse","aria-labelledby":"heading".concat(e.tid),"data-bs-parent":"#accordionTasks",children:(0,i.jsx)("div",{className:"accordion-body",children:(0,i.jsxs)("div",{className:"d-flex flex-column",children:[e.hasArtifact()&&(0,i.jsx)(k,{task:e,jobId:t}),(0,i.jsx)("div",{className:D()["log-body"],children:0===e.output.length?(0,i.jsx)("div",{className:"text-center text-muted",children:"No logs available"}):function(e){let t=e.split("\n"),s=RegExp("^(\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2},\\d{3}) - (\\d+) - (.+) - (.+) - (.*)$","s"),n=t.reduce((e,t)=>{let i=t.match(s);if(i){let t=i[1].replace(",","."),s=i[2],n=i[3],r=i[4],a=i[5].split("\r").reverse()[0];e.push({timestamp:t,pid:s,module:n,level:r,message:a})}return e},[]);return n.map((e,t)=>(0,i.jsxs)("div",{className:"d-flex flex-row ".concat(D()["log-line"]),children:[(0,i.jsx)("code",{className:D()["log-line-number"],children:t+1}),(0,i.jsxs)("code",{children:[(0,i.jsx)("span",{className:"user-select-none",title:e.timestamp,children:z(n[0].timestamp,e.timestamp)}),(0,i.jsxs)("span",{className:"user-select-none",children:["[",e.level,"]"]}),(0,i.jsx)("span",{style:{whiteSpace:"pre-wrap"},children:e.message})]})]},t))}(e.output)})]})})})]},e.tid))}):(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h5",{className:"card-title",children:"No tasks available"}),(0,i.jsx)("p",{className:"card-text",children:"If the job is queued, it has to wait for the previous jobs to finish."})]})})})]})]})}},1469:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var i=s(4298);let n=(e,t,s,n)=>{let r=(0,i.io)(e,{transports:["websocket"],path:"/ws"});var a=null;let o=()=>{a&&clearTimeout(a),a=setTimeout(()=>{s(),r.connect()},3e3)},l=()=>{a&&clearTimeout(a),a=setTimeout(()=>{s(),r.emit("join",t)},3e3)};return r.on("connect",()=>{console.log("WebSocket connection opened"),s(),r.emit("join",t)}),r.on("disconnect",e=>{"io server disconnect"===e&&(n("Server disconnected the socket"),o())}),r.on("error",e=>{n(e.message),r.emit("leave",t),l()}),r.on("connect_error",e=>{console.log("Connection error:",e),n("Connection error: "+e.message),o()}),{socket:r,unsubscribe:()=>{r.off("connect"),r.off("progress"),r.off("disconnect"),r.off("error"),r.off("connect_error"),a&&clearTimeout(a),r.disconnect()}}}},3401:(e,t,s)=>{"use strict";s.d(t,{cR:()=>l,qY:()=>a});var i=s(5155),n=s(7489),r=s(3578);let a=e=>{switch(e){case"pending":case"soft_failed":case"skipped":return"text-warning";case"queued":case"interrupting":return"text-info";case"created":case"running":return"text-primary";case"completed":return"text-success";case"failed":case"canceled":case"interrupted":return"text-danger";default:return""}},o=e=>{switch(e){case"running":return{spin:!0};case"queued":case"created":case"interrupting":return{fade:!0};default:return{}}},l=e=>{var t;switch(e){case"pending":t=r.SVv;break;case"queued":t=r.Exz;break;case"created":t=r.CQO;break;case"running":t=r.z1G;break;case"completed":t=r.SGM;break;case"soft_failed":t=r.lEd;break;case"failed":t=r.s0Q;break;case"skipped":t=r.vFJ;break;case"interrupting":t=r.APi;break;case"canceled":t=r.Dfk;break;case"interrupted":t=r.bFI;break;default:t=null}return t?(0,i.jsx)(n.g,{icon:t,...o(e),className:a(e)}):null}},4255:(e,t,s)=>{Promise.resolve().then(s.bind(s,1366))},4463:(e,t,s)=>{"use strict";s.d(t,{Ok:()=>r,Zr:()=>o,h1:()=>a});var i=s(5799),n=s(5695);let r=(e,t)=>(null==t||t(!0),fetch("/api/create-job",{method:"POST",body:e}).then(e=>e.json().catch(()=>{throw Error(e.statusText)})).then(e=>{if(!e.success)throw Error(e.message);return e.body.jid}).finally(()=>{null==t||t(!1)})),a=()=>{let e=(0,n.useRouter)();return(t,s)=>{i.oR.info("Submitting data and retrieving job info...",{autoClose:!1,isLoading:!0,draggable:!1}),r(t,s).finally(()=>{i.oR.dismiss()}).then(t=>{i.oR.success("Job information retrieved successfully!",{autoClose:2e3}),e.push("/job?jobId=".concat(t))}).catch(e=>{i.oR.error("Failed to start job: ".concat((null==e?void 0:e.message)||e))})}};function o(e){return e.charAt(0).toUpperCase()+e.slice(1).replace("_"," ")}},5796:()=>{},6365:(e,t,s)=>{"use strict";s.d(t,{C:()=>n});class i{hasArtifact(){for(let e of this.artifacts)if(!e.is_attached)return!0;return!1}static fromJSON(e){return new i(e.tid,e.name,e.status,e.message,e.output,e.artifacts)}constructor(e,t,s,i,n,r){this.tid=e,this.name=t,this.status=s,this.message=i,this.output=n,this.artifacts=r}}class n{static fromJSON(e){return new n(e.jid,e.created_at,e.started_at,e.finished_at,e.type,e.media,e.status,e.message,e.isProcessExited,e.result_artifact_index,Object.fromEntries(Object.entries(e.tasks).map(e=>{let[t,s]=e;return[t,i.fromJSON(s)]})))}constructor(e,t,s,i,n,r,a,o,l,c,d){this.jid=e,this.created_at=t,this.started_at=s,this.finished_at=i,this.type=n,this.media=r,this.status=a,this.message=o,this.isProcessExited=l,this.result_artifact_index=c,this.tasks=d}}},6472:(e,t,s)=>{"use strict";s.d(t,{y:()=>n});var i=s(2115);function n(e,t,s){let[n,r]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(!e)return;let i=new AbortController;return fetch(e,{signal:i.signal}).then(e=>e.json().catch(()=>{throw Error(e.statusText)})).then(e=>{if(!e.success)throw Error(e.message);r(e.body),s&&s(!1)}).catch(e=>{"AbortError"!==e.name&&(t(e.message),s&&s(!1))}),()=>{i.abort()}},[e]),n}},6653:()=>{},7580:()=>{},7665:e=>{e.exports={"progress-row":"page_progress-row__j55VT","log-line":"page_log-line__HyXNI","log-line-number":"page_log-line-number__9GnEG","log-body":"page_log-body__GQQeX","status-text":"page_status-text__UuCD2","region-content":"page_region-content__nk5ju"}}},e=>{var t=t=>e(e.s=t);e.O(0,[74,740,936,266,586,799,500,328,441,684,358],()=>t(4255)),_N_E=e.O()}]);